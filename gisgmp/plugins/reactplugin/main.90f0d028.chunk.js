(this.webpackJsonpweather=this.webpackJsonpweather||[]).push([[0],{1339:function(e,t,a){},1340:function(e,t,a){},1341:function(e,t,a){},1342:function(e,t,a){},1343:function(e,t,a){},1344:function(e,t,a){},1345:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),l=a(86),r=a.n(l),o=(a(208),a(16)),i=a(17),c=a(19),u=a(18),d=a(7),p=a.n(d),m=a(15),h=a(20),f=a(233),b=(a(620),a(1353)),_=a(1354),y=a(1355),g=a(1352),v=a(39),k=a(1348),O=a(1349),S=a(1350),E=a(1351),x=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];return(e=t.call.apply(t,[this].concat(s))).handleChange=function(t){e.props.setFieldValue(e.props.field.name,t.target.checked)},e}return Object(i.a)(a,[{key:"render",value:function(){var e={};return this.props.readOnly&&(e={readOnly:!0,onChange:null}),s.a.createElement("div",null,s.a.createElement("div",{style:this.props.errors[this.props.field.name]&&this.props.touched[this.props.field.name]&&{border:"1px solid #cc3333",borderRadius:"3px"}},s.a.createElement(k.a,{key:"input_".concat(this.props.field.name),check:!0},s.a.createElement(O.a,{check:!0},s.a.createElement(S.a,Object.assign({type:"checkbox",name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,checked:this.props.values[this.props.field.name],disabled:this.props.readOnly,invalid:this.props.errors[this.props.field.name]&&this.props.touched[this.props.field.name]},e))," ",this.props.field.displayName))),this.props.errors[this.props.field.name]&&this.props.touched[this.props.field.name]?s.a.createElement(E.a,null,this.props.errors[this.props.field.name]):s.a.createElement("div",null),s.a.createElement("br",null))}}]),a}(n.Component),w=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];return(e=t.call.apply(t,[this].concat(s))).handleChange=function(t){var a=""===t.target.value?null:t.target.value;(""===t.target.value||/^-?[0-9\b]*$/.test(t.target.value))&&e.props.setFieldValue(e.props.field.name,a)},e}return Object(i.a)(a,[{key:"render",value:function(){var e={};return this.props.readOnly&&(e={readOnly:!0,placeholder:"-",className:"rdev-read-only-control"}),s.a.createElement(k.a,{key:"input_".concat(this.props.field.name)},s.a.createElement(O.a,null,s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(S.a,Object.assign({name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,value:this.props.values[this.props.field.name]||null,invalid:this.props.errors[this.props.field.name]&&this.props.touched[this.props.field.name],disabled:""!=this.props.values.uin_field,type:"number"},e)),this.props.errors[this.props.field.name]&&this.props.touched[this.props.field.name]&&s.a.createElement(E.a,null,this.props.errors[this.props.field.name]))}}]),a}(n.Component),N=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];return(e=t.call.apply(t,[this].concat(s))).handleChange=function(t){e.props.setFieldValue(e.props.field.name,t.target.value),e.props.setFieldTouched(e.props.field.name,!0)},e}return Object(i.a)(a,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},s.a.createElement(k.a,{key:"input_".concat(this.props.field.name)},s.a.createElement(O.a,null,s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(S.a,{style:{height:"35px"},name:this.props.field.name,placeholder:"",onChange:this.handleChange,onBlur:this.props.onBlur,value:1!=this.props.values.count_field?"":this.props.values[this.props.field.name]||"",contentEditable:1==this.props.values.count_field,disabled:1!=this.props.values.count_field}))}}]),a}(n.Component),T=a(105),C=a(68),R=(n.Component,a(35)),j=(a(134),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={modalItems:[],selectedValue:""},n.getData=n.getData.bind(Object(h.a)(n)),n.handleChange=n.handleChange.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount"),e.next=3,this.getData();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"handleChange",value:function(e){console.log("handleChange, value=",e),this.setState({selectedValue:e}),this.props.setFieldValue(this.props.field,e)}},{key:"getData",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("/odata/reestr_parts_type?$select=template_name,recid&$orderBy=template_name&$filter=recstate eq 1",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(t.isNullOrEmptyResponse(e))return console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b");t.setState({modalItems:e.value})})).then((function(){return fetch("/odata/reestr_key_elements?$top=10&$select=part_type,recid&$filter=(recstate eq 1) and (part_type ne null)&$orderBy=reccreated desc",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}})})).then((function(e){return e.json()})).then((function(e){if(t.isNotEmptyOrNullArray(e.value))for(var a=0;a<e.value.length;a++)if(null!=e.value[a].part_type){var n=t.state.modalItems.find((function(t){return t.recid==e.value[a].part_type.toString()}));t.handleChange(n);break}})).catch((function(e){return console.log("Request failed: ",e)}));case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}},{key:"updateTest",value:function(){console.log("updateTest",this.props)}},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){return s.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},s.a.createElement(g.a,null,s.a.createElement(O.a,null,s.a.createElement("b",null,"\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u0435\u0439")),s.a.createElement(C.a,{id:this.props.field,name:this.props.field,getOptionLabel:function(e){return e.template_name},getOptionValue:function(e){return e.recid},options:this.state.modalItems,onChange:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",className:"basic-single",classNamePrefix:"select",value:this.state.selectedValue,isClearable:!0,isSearchable:!0,styles:{control:function(e,t){var a=t.isFocused;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:"white",boxShadow:a?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:a?"#68a1be":"#e4e7ea",":hover":{borderColor:a?"#68a1be":"#e4e7ea"}})},option:function(e,t){var a=t.isDisabled,n=t.isFocused,s=t.isSelected;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:a?null:s?"#f5fafe":n?"#ecf5ff":null,color:"black"})}}})))}}]),a}(n.Component)),D=a(123),A=a.n(D),M=a(12);M.a.configure();var I=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={activeRecord:{}},e}return Object(i.a)(a,[{key:"componentWillMount",value:function(){null!=window.activeRecord?this.setState({activeRecord:window.activeRecord}):this.setState({activeRecord:{reccode:null,reccreated:"2020-10-20T11:38:42.320928+08:00",reccreatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",recdescription:null,recid:"9f46e82c-f027-49d3-b81c-f032f869c25a",recname:null,recstate:1,recupdated:"2020-10-23T00:49:34.77997+08:00",recupdatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",sysboolean_test:!1,sysdate_test:null,sysdecimal_test:null,sysenum_test:1,sysfile_test:null,sysimage_test:"",sysint_test:null,sysmoney_test:0,sysnumber_test:"\u0421\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0423\u0418\u041d",sysstring_test:"",systime_test:null,systimedate_test:null}})}},{key:"render",value:function(){return s.a.createElement(V,Object(f.a)({method:{name:"test_procedure_update",displayName:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",isEnabled:null,isAnonymous:!1,static:!1,fields:[{name:"uin_field",type:"SysString",typeName:"SysString",displayName:"\u0423\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043d\u044b\u0439 \u0423\u0418\u041d",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"count_field",type:"SysInt",typeName:"SysInt",displayName:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"parttype_field",type:"SysRelation",typeName:"SysRelation",displayName:"\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u0435\u0439",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null}],showModalYesNo:null,initMethodParams:null,isPacketSigned:null,workflow:null,table:"types_table"},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord},"initialValues",{count_field:1}))}}]),a}(n.Component),V=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(n){console.log(n),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},e.state={},e.renderField=e.renderField.bind(Object(h.a)(e)),e.getInitialValues=e.getInitialValues.bind(Object(h.a)(e)),e.renderKeyElementTemplateSelect=e.renderKeyElementTemplateSelect.bind(Object(h.a)(e)),e.handleClick=e.handleClick.bind(Object(h.a)(e)),e}return Object(i.a)(a,[{key:"getInitialValues",value:function(){var e=this,t={};return this.props.method.fields.forEach((function(a){if(null!=e.props.initialValues){console.log(e.props.initialValues[a.name]);var n=void 0!==F[a.type]?F[a.type]:"";if(a.default){var s="var activeRecord = ".concat(JSON.stringify(e.props.initialValues),"; var result = ").concat(a.default,"(); return result;");n=new Function(s)()}t[a.name]=null!=e.props.initialValues[a.name]?e.props.initialValues[a.name]:n}else t[a.name]=F[a.type]})),t}},{key:"renderField",value:function(e,t,a){var n=this,l=Object.assign({},t);e.name=e.name.toLowerCase(),e.table=this.props.method.table;var r=q[e.type]||N;return s.a.createElement(v.a,{key:e.name.toLowerCase(),name:e.name.toLowerCase(),validate:a},(function(t){var a=t.formikfield;t.form;return s.a.createElement(r,Object.assign({field:e,setFieldValue:n.props.setFieldValue,onBlur:l.handleBlur,activeRecord:n.props.activeRecord},l,a))}))}},{key:"renderKeyElementTemplateSelect",value:function(e,t,a){var l=this,r=Object.assign({},t);return s.a.createElement(n.Fragment,null,s.a.createElement(v.a,{key:e.name.toLowerCase(),name:e.name.toLowerCase()},(function(t){var a=t.formikfield;t.form;return s.a.createElement(j,Object.assign(Object(f.a)({value:l.props,field:e.name.toLowerCase(),setFieldValue:r.setFieldValue,onChange:r.handleChange,key:e.name.toLowerCase()},"value",r.values[e.name.toLowerCase()]),r,a))})))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(v.c,{ref:"formik",initialValues:this.getInitialValues(),enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return s.a.createElement(v.b,{onSubmit:t.handleSubmit},s.a.createElement("h5",{class:"modal-title"},"\u0421\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0423\u0418\u041d"),s.a.createElement("hr",null),s.a.createElement(b.a,null,s.a.createElement(_.a,{className:"btnPerform",size:"sp",onClick:e.handleClick,color:"primary",type:"submit",style:{width:"124px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",s.a.createElement(_.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),s.a.createElement("hr",null),e.renderField(e.props.method.fields[0],t),s.a.createElement(y.a,null,s.a.createElement(g.a,{xs:12,md:8},e.renderKeyElementTemplateSelect(e.props.method.fields[2],t)),s.a.createElement(g.a,{xs:12,md:4},e.renderField(e.props.method.fields[1],t,e.validateCount))))}}))}},{key:"validateCount",value:function(e){var t;return(e<1||e>400)&&(t="\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0447\u0438\u0441\u043b\u043e \u043e\u0442 1 \u0434\u043e 400"),t}},{key:"handleClick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.refs.formik.state.values,console.log("values",t),a="",this.isNullObject(t.parttype_field)&&(a=String().concat(a,"\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0434\u0435\u0442\u0430\u043b\u0435\u0439.")),(null==t.count_field||t.count_field<1||t.count_field>400)&&(a=String().concat(a," ","\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0447\u0438\u0441\u043b\u0430 \u043e\u0442 1 \u0434\u043e 400.")),this.isEmptyString(t.uin_field)&&1==t.count_field&&(a=String().concat(a," ","\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d \u0423\u0418\u041d.")),!this.isNotEmptyString(a)){e.next=10;break}return e.abrupt("return",this.popupNotifyMessage(!1,a));case 10:return n={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({template:t.parttype_field.recid,count:t.count_field,uin:t.uin_field})},console.log("requestBody",n),e.next=14,this.sendRequestToOuterRdevAsync("/plugins/nbdlogicplugin/masscreatekeyelementsdraft",n.body);case 14:if(s=e.sent,console.log("result_replace_resp",s),!s.success){e.next=22;break}return window.closePluginModal(),1==t.count_field&&null!=s.data&&window.open("/tables/reestr_key_elements/".concat(s.data.recid),"_self"),e.abrupt("return",this.popupNotifyMessage(!0,"".concat(s.message)));case 22:return e.abrupt("return",this.popupNotifyMessage(!1,"".concat(s.message)));case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendRequestToOuterRdevAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:a});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"isEmptyString",value:function(e){return null==e||"undefined"===e||""===e||0===e.length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotNullObject",value:function(e){return null!=e&&"undefined"!==e&&e&&0!==Object.keys(e).length}},{key:"isEmptyOrNullArray",value:function(e){return!e||null==e||"undefined"===e||e.length<=0}},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}}]),a}(s.a.Component),q={SysString:N,SysInt:w,SysBoolean:x,SysNumber:w,SysRelation:j},F={SysGUID:"",SysString:"",SysMultiLineString:"",SysBoolean:!1,SysNumber:null,SysInt:null,SysMoney:0,SysDecimal:null,SysENUM:null,SysRelation:null},P=(a(658),n.Component,a(1356)),B=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=function(e){var t=""===e.target.value?null:e.target.value;(""===e.target.value||/^-?[0-9\b]*$/.test(e.target.value))&&(n.props.setFieldValue(n.props.field.name,t),n.props.updateData(t),n.setState({isValid:t>=1&&t<=400}))},n.state={isValid:!0},n}return Object(i.a)(a,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},!this.props.field.isPasported&&this.props.field.isUinDataEmpty&&this.props.field.isAssemblyElement?s.a.createElement(k.a,{key:"input_".concat(this.props.field.name)},s.a.createElement(O.a,null,s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(S.a,{type:"number",name:this.props.field.name,onChange:this.handleChange,value:this.props.field.count,defaultValue:1,invalid:!this.state.isValid}),!this.state.isValid&&s.a.createElement(P.a,null,"\u0417\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0434\u043e\u043b\u0436\u043d\u043e \u0441\u043e\u0434\u0435\u0440\u0436\u0430\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0446\u0438\u0444\u0440\u044b \u043e\u0442 1 \u0434\u043e 400")):s.a.createElement(k.a,{key:"input_".concat(this.props.field.name)},s.a.createElement(O.a,null,s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(S.a,{type:"number",name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,value:1,disabled:!0}))}}]),a}(n.Component),L=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;Object(o.a)(this,a);for(var n=arguments.length,s=new Array(n),l=0;l<n;l++)s[l]=arguments[l];return(e=t.call.apply(t,[this].concat(s))).handleChange=function(t){console.log(t.target.value),e.props.updateUinFieldValue(t.target.value),e.props.setFieldValue(e.props.field.name,t.target.value),e.props.updateUinFieldState(""==t.target.value||null==t.target.value),e.props.updateUinState()},e}return Object(i.a)(a,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},s.a.createElement(k.a,null,s.a.createElement(O.a,null,s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(S.a,{name:this.props.field.name,onChange:this.handleChange,onBlur:this.props.onBlur,value:this.props.field.value,defaultValue:"",disabled:this.props.field.isDisabled}))}}]),a}(n.Component),G=a(180),z=(a(659),a(152)),$=a(1362),U=a(1357),H=a(1358),J=a(1359),K=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),null!=e&&e.length>s.state.options.length&&s.handleNewOptionClick(e[e.length-1]);var t=e.map((function(e){return{number:e.number,position:e.position}}));s.props.setFieldValue(s.props.field.name,JSON.stringify(t))},s.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,l,r,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),a=t.value,s.setState({isLoadingDetail:!0}),e.next=5,s.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(a,"')"));case 5:if(n=e.sent,!s.isNullOrEmptyResponse(n)){e.next=8;break}return e.abrupt("return",s.modalError("\u0423\u0418\u041d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435"));case 8:return l=n.value[0],e.next=11,s.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(l.recid,")"));case 11:return r=e.sent,e.next=14,s.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(l.recid,")"));case 14:if(o=e.sent,!s.isNullOrEmptyResponse(o)||!s.isNullOrEmptyResponse(r)){e.next=17;break}return e.abrupt("return",s.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 17:if((i=s.state.addedItems).push(a),!(null!=s.state.options&&s.state.options.length>0)){e.next=24;break}if(c=Object(T.a)(s.state.options),null==c.find((function(e){return e.numberValue==a}))){e.next=24;break}return e.abrupt("return",s.modalError("\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d."));case 24:if(s.isNullOrEmptyResponse(r)||!s.isNullOrEmptyResponse(o)){e.next=31;break}return u=r.value[0],e.next=28,s.defineKeyElementPositions(u);case 28:s.setState({addedItems:i}),e.next=36;break;case 31:if(s.isNullOrEmptyResponse(o)){e.next=36;break}return d=o.value[0],e.next=35,s.defineAssemblyElementPositions(d);case 35:s.setState({addedItems:i});case 36:s.props.updateUinElementsFieldState(0==s.state.addedItems.length||null==s.state.addedItems),s.props.updateUinState();case 38:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s.popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(n.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(n.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(s){console.log(s),M.a.error(n.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},s.prepareValue=function(){return s.props.value instanceof Array?s.props.value[0]:s.props.value},s.state={selectedTemplate:s.props.field.selectedTemplate,options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null},s.handleNewOptionClick=s.handleNewOptionClick.bind(Object(h.a)(s)),s.getOptions=s.getOptions.bind(Object(h.a)(s)),s.handleModalChange=s.handleModalChange.bind(Object(h.a)(s)),s.renderDeleteConfirm=s.renderDeleteConfirm.bind(Object(h.a)(s)),s.handleOkModal=s.handleOkModal.bind(Object(h.a)(s)),s}return Object(i.a)(a,[{key:"componentWillReceiveProps",value:function(e){e.field.selectedTemplate!==this.state.selectedTemplate&&this.setState({selectedTemplate:e.field.selectedTemplate,options:[]})}},{key:"assemblyElementAlreadyExist",value:function(e,t){return 0==e.length||null==e.find((function(e){return null!=e.node&&null!=t&&e.node==t}))}},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&this.popupNotifyMessage(!1,e)}},{key:"defineKeyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,s,l,r,o,i,c,u,d,m,h,f,b,_,y,g,v,k,O,S,E,x,w,N,T,C,R,j,D=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null,n=null,s=null,l=null,null==t.ke_node||""==t.ke_node){e.next=18;break}return e.next=7,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.ke_node,")"));case 7:if(r=e.sent,!this.isNullOrEmptyResponse(r)){e.next=10;break}return e.abrupt("return");case 10:if(a=r.value[0],n=a.recid,s=a.ke_node_type,l=t.position_on_node,!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,n)){e.next=16;break}return e.abrupt("return",this.modalError("\u0423\u043a\u0430\u0437\u0430\u043d\u043d\u044b\u0439 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d \u0432 \u0444\u043e\u0440\u043c\u0443."));case 16:if("477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"e4ef0365-0365-40df-ab4e-a77104c352df"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o||null==l){e.next=18;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430."));case 18:return o=t.key_element_code,t.documentation_number_calculated,this.setState({currentElement:t,currentElementType:"keyElement"}),e.next=23,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(this.props.field.options.recid,")"));case 23:if(i=e.sent,!this.isNullOrEmptyResponse(i)){e.next=26;break}return e.abrupt("return");case 26:return c=i.value[0],u=c.ke_node_type,e.next=30,this.checkAssemblyElementCompositionAsync(t,a,u);case 30:if((d=e.sent).success){e.next=33;break}return e.abrupt("return",this.modalError(d.message));case 33:if(null!=n&&""!=n){e.next=99;break}return m=null!=u&&""!=u?" and (node_type eq ".concat(u,")"):"",e.next=37,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(o,")").concat(m));case 37:if(h=e.sent,f=h.value,b=[],_=[],"477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"34c12f72-eb33-4ab1-ba3e-a80166258e5d"!=o&&"ff1d8011-75dc-4d30-832f-f47c3d5ac430"!=o&&"4aed23f8-9710-4904-a2f5-b89d9bc7c75c"!=o&&"975cd310-7675-4436-899f-4c6b84555f6a"!=o&&"38dd229a-915f-49ef-bba8-a28f055c9962"!=o||0!=f.length){e.next=45;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 45:if("e4ef0365-0365-40df-ab4e-a77104c352df"!=o){e.next=87;break}if(t.has_rough_axis_number){e.next=50;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 50:return e.next=52,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(ke_node_type eq ".concat(u,") and (scheme eq ").concat(c.documentation,")"));case 52:if(y=e.sent,!this.isNullOrEmptyResponse(y)){e.next=55;break}return e.abrupt("return",this.modalError('\u0414\u043b\u044f \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0443\u0437\u043b\u0430/\u0421\u0415 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0437\u0430\u043f\u0438\u0441\u044c \u0432 \u0441\u043f\u0440\u0430\u0432\u043e\u043d\u0438\u043a\u0435 "\u041a\u043e\u043b-\u0432\u043e \u0421\u0427/\u0421\u0415 \u0432 \u0421\u0415/\u0443\u0437\u043b\u0435".'));case 55:if(null!=(g=y.value[0]).rough_axis_count&&0!=g.rough_axis_count){e.next=60;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 60:if(v=null,!t.has_rough_axis_number){e.next=69;break}if(null!=t.rough_axis&&""!=t.rough_axis){e.next=64;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u041e\u0441\u0438 \u0447\u0438\u0441\u0442\u043e\u0432\u043e\u0439 \u043d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u0430 \u0441\u0441\u044b\u043b\u043a\u0430 \u043d\u0430 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0443\u044e."));case 64:return e.next=66,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(t.rough_axis,")"));case 66:if(null!=(v=e.sent)){e.next=69;break}return e.abrupt("return",this.modalError("\u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f, \u0443\u043a\u0430\u0437\u0430\u043d\u043d\u0430\u044f \u0432 \u043e\u0441\u0438 \u0447\u0438\u0441\u0442\u043e\u0432\u043e\u0439, \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u0430 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 69:if(null==t.blockchainhash||""==t.blockchainhash||null!=v.blockchainhash&&""!=v.blockchainhash){e.next=71;break}return e.abrupt("return",this.modalError("\u041d\u0435\u043b\u044c\u0437\u044f \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u041e\u0441\u044c \u0447\u0438\u0441\u0442\u043e\u0432\u0443\u044e \u0441 \u0423\u0418\u041d ".concat(t.numberke,", \u043f\u043e\u0442\u043e\u043c\u0443 \u0447\u0442\u043e \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u0430\u044f \u0441 \u043d\u0435\u0439 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f \u0441 \u0423\u0418\u041d ").concat(v.numberke," \u043d\u0435 \u0432\u044b\u043f\u0443\u0449\u0435\u043d\u0430 \u0432 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435.")));case 71:if(null!=t.blockchainhash&&""!=t.blockchainhash){e.next=75;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return",this.popupNotifyMessage(!0,"\u0421\u0427 \u041e\u0441\u044c \u0447\u0438\u0441\u0442\u043e\u0432\u0430\u044f \u0441 \u0423\u0418\u041d ".concat(t.numberke," \u043d\u0435 \u0432\u044b\u043f\u0443\u0449\u0435\u043d \u0432 \u043e\u0431\u0440\u0430\u0449\u0435\u043d\u0438\u0435, \u043f\u043e\u044d\u0442\u043e\u043c\u0443 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0439 \u0441 \u043d\u0438\u043c \u0421\u0427 \u041e\u0441\u044c \u0427\u0435\u0440\u043d\u043e\u0432\u0430\u044f c \u0423\u0418\u041d ").concat(v.numberke," \u043d\u0435 \u0431\u0443\u0434\u0435\u0442 \u0430\u0432\u0442\u043e\u043c\u0430\u0442\u0438\u0447\u0435\u0441\u043a\u0438 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d.")));case 75:if(null==t.blockchainhash||""==t.blockchainhash||null==v.blockchainhash||""==v.blockchainhash){e.next=84;break}if(k=this.props.refComponentDataGrid.getStateTableData(),null!=k.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=82;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 82:return e.next=84,this.updateStateTable("add",{value:v.recid,number:v.recid,numberValue:v.numberke,node:null,nodeObj:v,isKeyElement:!0});case 84:return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 87:if("a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o){e.next=89;break}return e.abrupt("return",this.modalError("\u041d\u0435\u043b\u044c\u0437\u044f \u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0421\u0427 \u0442\u0438\u043f\u0430 \u041e\u0441\u044c \u0447\u0435\u0440\u043d\u043e\u0432\u0430\u044f."));case 89:if(this.state.options.length>0)for(O=0;O<this.state.options.length;O++)_.push(this.state.options[O].position);if((b=_.length>0?f.filter((function(e){return null==_.find((function(t){return t==e.recid}))})):f).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),1!=b.length){e.next=96;break}return this.setState({modalItems:b,modalValue:b[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 96:this.setState({modalItems:b,modalValue:""}),e.next=148;break;case 99:if("477d0c01-84d3-441c-9bb9-15f9d609671d"!=o&&"e4ef0365-0365-40df-ab4e-a77104c352df"!=o&&"b28e1a4f-d340-4ce0-a37a-d84dcfa1b6fb"!=o&&"8cdec5a2-69ac-4dd9-8568-f53853b55f86"!=o&&"9c60e01e-b4b7-448a-ae1b-7709f55d43a2"!=o&&"966f3039-1528-4af5-9e8e-2378dd738243"!=o&&"6eab3f2a-03b7-4570-9278-55944ed353d2"!=o&&"a70ac9bc-3212-4361-9b83-ab36282f7c97"!=o&&"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"!=o){e.next=101;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0443\u0437\u043b\u0430 \u043d\u0435\u043b\u044c\u0437\u044f \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0443\u044e \u0447\u0430\u0441\u0442\u044c \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0442\u0438\u043f\u0430."));case 101:if(m=null!=s&&""!=s?" and (parent_node_type eq ".concat(u,")"):"",S="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=u){e.next=109;break}return e.next=106,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(c.documentation,") and\n\t\t\t\t\t\t(ke_node_type eq ").concat(u,")"));case 106:E=e.sent,x=E.value[0],S=x.slider_body_count>2&&x.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 109:return e.next=111,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=(key_element_code eq ".concat(o,") and (child_node_type eq ").concat(s,")").concat(m).concat(S));case 111:if(w=e.sent,N=w.value,T=[],T=N.filter((function(e){return e.position_on_node==l})),C=T.map((function(e){return e.alternative_position})),[],N.filter((function(e){return null!=C.find((function(t){return t==e.recname}))})).map((function(e){null==T.find((function(t){return t.recid==e.recid}))&&T.push(e)})),_=[],b=[],!(this.state.options.length>0)){e.next=136;break}O=0;case 123:if(!(O<this.state.options.length)){e.next=136;break}if(this.state.options[O].isKeyElement){e.next=132;break}return e.next=127,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t\t\t\t\t\t(child_node_type eq ".concat(this.state.options[O].nodeObj.ke_node_type,") \n\t\t\t\t\t\t\t\tand (node_position eq ").concat(this.state.options[O].position,")").concat(S));case 127:w=e.sent,(R=w.value).length>0&&R.forEach((function(e){_.push(e.recid)})),e.next=133;break;case 132:_.push(this.state.options[O].position);case 133:O++,e.next=123;break;case 136:if(b=_.length>0?T.filter((function(e){return null==_.find((function(t){return t==e.recid}))})):T,j=[],this.state.options.length>0)for(O=0;O<this.state.options.length;O++)null!=this.state.options[O].node&&this.state.options[O].node!=n&&null!=this.state.options[O].positionObj&&null!=this.state.options[O].positionObj.child_node_type&&null!=(j=b.filter((function(e){return e.parent_node_type==u&&e.node_position==D.state.options[O].positionObj.node_position&&e.child_node_type==D.state.options[O].positionObj.child_node_type})))&&j.length>0&&(b=b.filter((function(e){return null==j.find((function(t){return t.recid==e.recid}))})));if(b.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),!(b.length<=1)){e.next=146;break}return this.setState({modalItems:b,modalValue:b[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 146:this.setState({modalItems:b,modalValue:""});case 147:this.setState({modalItems:b,modalValue:""});case 148:this.setState({showModal:!0});case 149:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"defineAssemblyElementPositions",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,s,l,r,o,i,c,u,d,m,h,f,b,_,y,g,v,k;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({currentElement:t,currentElementType:"assemblyElement"}),!(this.state.options.length>0)||this.assemblyElementAlreadyExist(this.state.options,t.recid)){e.next=3;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t.unique_number," \u0443\u0436\u0435 \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u0430 \u0432 \u0444\u043e\u0440\u043c\u0443.")));case 3:return e.next=5,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types(".concat(t.ke_node_type,")"));case 5:if(a=e.sent,console.log("ddd",a),!a.is_variable){e.next=9;break}return e.abrupt("return",this.modalError("\u0414\u043b\u044f \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043a\u0438 \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u0443\u0439\u0442\u0435 \u0421\u0427."));case 9:return console.log("assemblyUnit",t),e.next=12,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(this.props.field.options.recid,")"));case 12:if(n=e.sent,!this.isNullOrEmptyResponse(n)){e.next=15;break}return e.abrupt("return");case 15:if(s=n.value[0],l=s.ke_node_type,r="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=l){e.next=24;break}return e.next=21,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(s.documentation,") and\n\t\t\t\t(ke_node_type eq ").concat(l,")"));case 21:o=e.sent,i=o.value[0],r=i.slider_body_count>2&&i.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 24:return e.next=26,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(a.recid,") and \n\t\t\t(parent_node_type eq ").concat(l,") ").concat(r));case 26:return c=e.sent,u=c.value,console.log("aaaa",u),e.next=31,this.checkAssemblyElementCompositionAsync(null,t,l);case 31:if((d=e.sent).success){e.next=34;break}return e.abrupt("return",this.modalError(d.message));case 34:m=[],h=[],f=[],b=Object(G.a)(u),e.prev=38,b.s();case 40:if((_=b.n()).done){e.next=49;break}if(null==(y=_.value).node_position||null!=m.find((function(e){return e.recid==y.node_position}))){e.next=47;break}return e.next=45,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recid eq ".concat(y.node_position,")"));case 45:g=e.sent,this.isNullOrEmptyResponse(g)||m.push(g.value[0]);case 47:e.next=40;break;case 49:e.next=54;break;case 51:e.prev=51,e.t0=e.catch(38),b.e(e.t0);case 54:return e.prev=54,b.f(),e.finish(54);case 57:if(this.state.options.length>0)for(v=0;v<this.state.options.length;v++)(k=this.state.options[v]).isKeyElement?null!=k.position&&k.positionObj.child_node_type==a.recid&&h.push(k.positionObj.node_position):null!=k.position&&a.recid==k.nodeObj.ke_node_type&&h.push(k.positionObj.recid);if(!(h.length>0)){e.next=64;break}if(0!=(f=m.filter((function(e){return null==h.find((function(t){return t==e.recid}))}))).length){e.next=62;break}return e.abrupt("return",this.modalError("\u041d\u0435\u0442 \u0441\u0432\u043e\u0431\u043e\u0434\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439 \u0434\u043b\u044f \u0434\u0430\u043d\u043d\u043e\u0439 \u0421\u0415."));case 62:e.next=65;break;case 64:f=m;case 65:if(0!=f.length){e.next=69;break}return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 69:if(f.sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),!(f.length<=1)){e.next=76;break}return this.setState({modalItems:f,modalValue:f[0],showModal:!0}),this.handleOkModal(),e.abrupt("return");case 76:this.setState({modalItems:f,modalValue:""});case 77:this.setState({modalItems:f,modalValue:""}),this.setState({showModal:!0});case 79:case"end":return e.stop()}}),e,this,[[38,51,54,57]])})));return function(t){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleOkModal",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n,s,l,r,o,i,c,u,d;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleOkModal_",this),console.log("handleOkModal__",this.state),t=this.state.options,console.log("handleOkModal",t),c=!1,"keyElement"==this.state.currentElementType?(null==this.state.modalValue||""==this.state.modalValue?a="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated):(a="".concat(this.state.currentElement.numberke,", ").concat(this.state.currentElement.key_element_code_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),n=this.state.modalValue.recid,s=this.state.modalValue),l=null!=this.state.currentElement.ke_node&&""!=this.state.currentElement.ke_node?this.state.currentElement.ke_node:null,u=this.state.currentElement.numberke,r=this.state.currentElement.recid,o=null!=l?"#4bf1547d":"#ebf5ff",i=null!=l?"#027707":"#007eff",c=!0):"numberkeConfirm"==this.state.currentElementType?(console.log(this.state),null!=this.state.modalValue&&""!=this.state.modalValue||(a="".concat(this.state.currentElement)),u=this.state.currentElement,c=!0):(null==this.state.modalValue||""==this.state.modalValue?a="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated):(a="".concat(this.state.currentElement.unique_number,", ").concat(this.state.currentElement.ke_node_type_calculated," : \u043f\u043e\u0437\u0438\u0446\u0438\u044f ").concat(this.state.modalValue.recname),n=this.state.modalValue.recid,s=this.state.modalValue),u=this.state.currentElement.unique_number,l=this.state.currentElement.recid,r=this.state.currentElement.recid,o="#4bf1547d",i="#027707"),console.log("handleOkModal2",t),t.push({value:"".concat(this.state.currentElement.recid),label:a,position:n,positionObj:s,number:r,numberValue:u,backgroundColor:o,color:i,node:l,nodeObj:this.state.currentElement,isKeyElement:c}),console.log("handleOkModal3",t),this.setState({options:t,showModal:!1,isLoadingDetail:!1,modalValue:""}),console.log("handleOkModal4",t),d=t.map((function(e){return{number:e.number,position:e.position,numberValue:e.numberValue}})),this.props.setFieldValue(this.props.field.name,JSON.stringify(d)),e.next=15,this.updateStateTable("add");case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,a=t.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return a=e.sent,n=a.value,console.log("getAssemblyElementPattern",n.length),e.abrupt("return",n.length>0?n[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n,s,l,r,o,i,c,u,d,m,h;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAllNodePositions();case 2:if(n=e.sent,console.log("this_update_state_table",this),null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),s=this.props.refComponentDataGrid.getStateTableData()),l=null,r=null,o=null,null!=a?r=a:(console.log("add",this.state.options.length),"add"==t?r=this.state.options[this.state.options.length-1]:"delete"==t&&(r=this.state.itemForDelete)),null!=r){e.next=11;break}return e.abrupt("return");case 11:if(i=null,c=null,null==this.props.field.options.recid){e.next=21;break}return e.next=16,this.getAssemblyElementPattern(this.props.field.options.recid);case 16:if(null!=(u=e.sent)&&null!=u.ke_node_type&&null!=u.documentation){e.next=19;break}return e.abrupt("return");case 19:i=u.ke_node_type,c=u.documentation;case 21:if(null!=(l=r.isKeyElement?null!=r.node?s.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==r.positionObj.child_node_type})):s.find((function(e){return null!=e.keyElementTypeId&&e.keyElementTypeId==r.nodeObj.key_element_code})):s.find((function(e){return null!=e.assemblyElementTypeId&&e.assemblyElementTypeId==r.nodeObj.ke_node_type})))){e.next=24;break}return e.abrupt("return");case 24:if("delete"!=t||0!=l.usedPositionsCount){e.next=26;break}return e.abrupt("return");case 26:if(null==l.assemblyElementTypeId){e.next=32;break}return e.next=29,this.getAvailablePositionsByAssemblyElementOnAssemblyElement(i,l.assemblyElementTypeId,c,n);case 29:o=e.sent,e.next=36;break;case 32:if(null==l.keyElementTypeId){e.next=36;break}return e.next=35,this.getAvailablePositionsByKeyElementOnAssemblyElement(i,l.keyElementTypeId);case 35:o=e.sent;case 36:d=s.indexOf(l),"add"==t?l.usedPositionsCount=l.usedPositionsCount+1:"delete"==t&&(l.usedPositionsCount=l.usedPositionsCount-1),l.isFull=l.usedPositionsCount===l.positionsCount,l.assemblyElementCountStr=l.usedPositionsCount+" \u0438\u0437 "+l.positionsCount,null!=o&&o.length>0?(h=o.map((function(e){return e.recname})),m=h.join(", ")):m=null,l.assemblyElementAvailablePositions=m,s[d]=l,null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),s=this.props.refComponentDataGrid.setStateTableData(s));case 44:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n,s,l,r,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!=t&&""!=t?" and (node_type eq ".concat(t,")"):"",e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(a,")").concat(n));case 3:if(s=e.sent,l=s.value,console.log("allPositionsResp",l.length),null!=l||0!=l.length){e.next=8;break}return e.abrupt("return",null);case 8:for(r=[],o=[],null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),i=this.props.refComponentDataGrid.state.childKeyElements),console.log("installedKeyElements",this.state),c=0;c<i.length;c++)null!=i[c].position_on_node&&r.push(i[c].position_on_node);if(console.log("installedKeyElements",this.state.options),this.state.options.length>0)for(c=0;c<this.state.options.length;c++)r.push(this.state.options[c].position);return(o=r.length>0?l.filter((function(e){return null==r.find((function(t){return t==e.recid}))})):l).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a,n,s){var l,r,o,i,c,u,d,m,h,f,b,_,y,g,v,k;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=7;break}return e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(n,") and\n\t\t\t\t(ke_node_type eq ").concat(t,")"));case 4:r=e.sent,o=r.value[0],l=o.slider_body_count>2&&o.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 7:return e.next=9,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(a,") \n\t\t\tand (parent_node_type eq ").concat(t,") \n\t\t\t").concat(l));case 9:i=e.sent,c=i.value,u=[],d=[],m=[],h=Object(G.a)(c);try{for(h.s();!(f=h.n()).done;)null!=(b=f.value).node_position&&null==u.find((function(e){return e.recid==b.node_position}))&&null!=(_=s.find((function(e){return e.recid==b.node_position})))&&u.push(_)}catch(p){h.e(p)}finally{h.f()}if(console.log("allPositionsOnNode",u.length),null!=u||0!=u.length){e.next=19;break}return e.abrupt("return",null);case 19:for(null!=this.props.refComponentDataGrid&&(console.log("refComponentDataGrid",this.props.refComponentDataGrid),y=this.props.refComponentDataGrid.state.childAssemblyElements),console.log("alreadyInstalledNodes",y.length),g=0;g<y.length;g++)null!=(v=y[g]).position_on_assembly_element&&d.push(v.position_on_assembly_element);if(console.log("athis.state.optionsaa",this.state.options),this.state.options.length>0)for(g=0;g<this.state.options.length;g++)(k=this.state.options[g]).isKeyElement?null!=k.position&&k.positionObj.child_node_type==a&&d.push(k.positionObj.node_position):null!=k.position&&a==k.nodeObj.ke_node_type&&d.push(k.positionObj.recid);return(m=d.length>0?u.filter((function(e){return null==d.find((function(t){return t==e.recid}))})):u).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",m);case 27:case"end":return e.stop()}}),e,this)})));return function(t,a,n,s){return e.apply(this,arguments)}}()},{key:"checkAssemblyElementCompositionAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a,n){var s,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==a){e.next=9;break}return e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(n,") and (child_assembly_element eq ").concat(a.ke_node_type,")"));case 3:if(s=e.sent,null!=(l=s.value)&&0!=l.length){e.next=7;break}return e.abrupt("return",{success:!1,message:"\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 "+a.unique_number+" ("+a.ke_node_type_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430."});case 7:e.next=15;break;case 9:return e.next=11,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(n,") and (child_key_element eq ").concat(t.key_element_code,")"));case 11:if(s=e.sent,null!=(l=s.value)&&0!=l.length){e.next=15;break}return e.abrupt("return",{success:!1,message:"\u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c "+t.numberke+" ("+t.key_element_code_calculated+") \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0434\u0430\u043d\u043d\u043e\u0433\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0433\u043e \u044d\u043b\u0435\u043c\u0435\u043d\u0442\u0430."});case 15:return e.abrupt("return",{success:!0,message:null});case 16:case"end":return e.stop()}}),e,this)})));return function(t,a,n){return e.apply(this,arguments)}}()},{key:"getOptions",value:function(){var e=this;this.setState({isLoading:!0}),fetch("/odata/$metadata/".concat(this.props.field.relation.table),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){var a=t.fieldGroups.autoLookup.fields.map((function(e){return e.name.toLowerCase()})),n=e.props.field.relation,s=n.field,l=n.displayField;null==s&&(s="recid"),null==l&&(l="recname"),null==a.find((function(e){return e==l.toLowerCase()}))&&a.push(l.toLowerCase());var r="",o=!1;if(null!=e.props.field.lookup){var i=e.props.field.lookup.field,c=e.props.activeRecord[i];r="$filter=(".concat(i," eq '").concat(c,"')"),-1==a.findIndex((function(e){return e==i}))&&(a.push(i),o=!0)}fetch("/odata/".concat(e.props.field.relation.table,"?").concat(r,"&$select=").concat(a.join(",")),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}}).then((function(e){return e.json()})).then((function(t){o&&(a=a.filter((function(t){return t!=e.props.field.lookup.field}))),-1==t.value.findIndex((function(t){return t.recid==e.props.value}))&&e.props.setFieldValue(e.props.field.name,null);var n=t.value.map((function(e){return{id:e[s.toLowerCase()],value:a.filter((function(e){return"recid"!=e})).map((function(t){return e[t]})).join(", ")}})).sort((function(e,t){return e.value<t.value?-1:e.value>t.value?1:0}));e.setState({options:n,isLoading:!1,isLoadingDetail:!1})}))}))}},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,s,l,r,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Object(T.a)(this.state.options),-1!==(n=a.indexOf(t))&&(a.splice(n,1),this.setState({options:a}),this.props.setFieldValue(this.props.field.name,JSON.stringify(a))),this.setState({showDeleteModal:!1}),s=Object(T.a)(this.state.addedItems),l=s.find((function(e){return e==t.numberValue})),-1!==(r=s.indexOf(l))&&(s.splice(r,1),this.setState({addedItems:s}),this.props.updateUinElementsFieldState(0==s.length||null==s),this.props.updateUinState()),!(o=this.state.itemForDelete).isKeyElement||"e4ef0365-0365-40df-ab4e-a77104c352df"!=o.nodeObj.key_element_code){e.next=24;break}if(null==this.props.refComponentDataGrid){e.next=15;break}if(console.log("refComponentDataGrid",this.props.refComponentDataGrid),null!=(i=this.props.refComponentDataGrid.getStateTableData(i))||0!=i.length){e.next=15;break}return e.abrupt("return");case 15:if(null==i.find((function(e){return"a0e6b16a-5fee-4318-a4dc-115ae65d4b09"==e.keyElementTypeId}))){e.next=24;break}if(!o.nodeObj.has_rough_axis_number||null==o.nodeObj.rough_axis||""==o.nodeObj.rough_axis){e.next=24;break}return e.next=20,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements(".concat(o.nodeObj.rough_axis,")"));case 20:if(null==(c=e.sent)){e.next=24;break}return e.next=24,this.updateStateTable("delete",{value:c.recid,number:c.recid,numberValue:c.numberke,node:null,nodeObj:c,isKeyElement:!0});case 24:return e.next=26,this.updateStateTable("delete");case 26:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return n.createElement($.a,{isOpen:this.state.showDeleteModal,size:"xl"},n.createElement(U.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),n.createElement(H.a,null,n.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),n.createElement(J.a,null,n.createElement(_.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},n.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),n.createElement(_.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},n.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;console.log("render_creatable",this.props);return n.createElement(k.a,null,n.createElement(O.a,null,n.createElement("b",null,this.props.field.displayName)),n.createElement(z.a,{name:this.props.field.name,components:{MultiValue:function(t){var a={backgroundColor:t.data.backgroundColor,color:t.data.color};return n.createElement("div",{className:"SelectValue",style:a},n.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t.data)}},"\xd7"),n.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,n.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.options,isMulti:!0,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.props.field.isDisabled||this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,styles:{control:function(e,t){var a=t.isFocused;return Object(R.a)(Object(R.a)({},e),{},{boxShadow:a?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:a?"#68a1be":"#e4e7ea",":hover":{borderColor:a?"#68a1be":"#e4e7ea"}})},option:function(e,t){var a=t.isDisabled,n=t.isFocused,s=t.isSelected;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:a?null:s?"#f5fafe":n?"#ecf5ff":null,color:"black"})}}}),n.createElement($.a,{isOpen:this.state.showModal,toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},n.createElement(U.a,{toggle:function(){return e.setState({showModal:!1,isLoadingDetail:!1})}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),n.createElement(H.a,null,n.createElement(b.a,null,n.createElement(_.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal,style:{width:"124px",height:"32px"}},n.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",n.createElement(_.a,{size:"sm",onClick:function(){return e.setState({showModal:!1,modalItems:[],isLoadingDetail:!1})},style:{width:"103.63px",height:"32px"}},n.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),n.createElement("hr",null),n.createElement(O.a,null,"\u041d\u043e\u043c\u0435\u0440"),n.createElement(S.a,{id:"number",value:"keyElement"==this.state.currentElementType?this.state.currentElement.ke_number_calculated:this.state.currentElement.unique_number,readOnly:!0}),n.createElement("br",null),n.createElement(O.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),n.createElement(S.a,{id:"element_name",value:"keyElement"==this.state.currentElementType?this.state.currentElement.key_element_code_calculated:this.state.currentElement.ke_node_type_calculated,readOnly:!0}),n.createElement("br",null),n.createElement(O.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),n.createElement(C.a,{name:"testname",options:this.state.modalItems,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",getOptionLabel:function(e){return e.recname},getOptionValue:function(e){return e.recid},onChange:this.handleModalChange,value:this.state.modalValue,onValueClick:function(t){return e.popupNotifyMessage(!0,t.value)},styles:{control:function(e,t){var a=t.isFocused;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:"white",boxShadow:a?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:a?"#68a1be":"#e4e7ea",":hover":{borderColor:a?"#68a1be":"#e4e7ea"}})},option:function(e,t){var a=t.isDisabled,n=t.isFocused,s=t.isSelected;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:a?null:s?"#f5fafe":n?"#ecf5ff":null,color:"black"})}}}))),this.renderDeleteConfirm())}}]),a}(n.Component),W=a(61),Z=a.n(W),Y=a(1360),Q=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).onCellPrepared=function(e){console.log(e.data),"data"===e.rowType&&null!=e.data&&(e.cellElement.style.backgroundColor=e.data.positionsCount==e.data.usedPositionsCount?"rgb(91, 223, 127)":"rgb(222, 91, 91)")},n.state={options:[],selectedRowNotes:"",data:[],uin:"",elements_in_vagon:{},select_element:{},is_circ:!1,visible_alert:!1,name_old_element:"",name_new_element:null,elementType:"",assemblyElementPatternId:null,stateTableLoaded:!1,stateTableLoading:!1,childKeyElements:[],childAssemblyElements:[]},n.loadStateTable=n.loadStateTable.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount",this.props),console.log("this_componentDidMount",this),e.next=4,this.loadStateTable();case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("componentDidUpdate",this),this.props.ref=this,this.state.assemblyElementPatternId==this.props.field.data){e.next=11;break}if(this.state.stateTableLoaded||this.state.stateTableLoading||null==this.props.field.data){e.next=7;break}return e.next=6,this.loadStateTable();case 6:return e.abrupt("return");case 7:if(!this.state.stateTableLoaded||this.state.stateTableLoading||this.state.assemblyElementPatternId!=this.props.field.data==null){e.next=11;break}return e.next=10,this.loadStateTable();case 10:return e.abrupt("return");case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n,s,l,r,o,i,c,u,d,m,h,f,b,_,y,g,v,k,O,S;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loadStateTable",this.props),this.setState({stateTableLoading:!0}),this.props.updateStateTableLoading(!0),t="assemblyElement",this.setState({elementType:t}),e.next=7,this.getAllKeyElementTypes();case 7:return a=e.sent,e.next=10,this.getAllAssemblyElementTypes();case 10:return n=e.sent,e.next=13,this.getAllNodePositions();case 13:if(s=e.sent,l=[],"assemblyElement"!=t){e.next=81;break}return r=null,o=null,e.next=20,this.getAssemblyElementPattern(this.props.field.data);case 20:if(i=e.sent,console.log("assemblyElementPattern",i),this.setState({assemblyElementPatternId:i.recid}),null!=i&&null!=i.ke_node_type&&null!=i.documentation){e.next=29;break}return this.setState({stateTableLoading:!1,stateTableLoaded:!0}),this.props.updateStateTableLoading(!1),this.props.updateStateTableLoaded(!0),this.setStateTableData([]),e.abrupt("return");case 29:if(r=i.ke_node_type,o=i.documentation,null==r){e.next=81;break}return console.log("parentAssemblyElementTypeId",[r,o]),e.next=35,this.getAssemblyElementComposition(r,o);case 35:if(c=e.sent,console.log("assemblyElementComposition",c),console.log("assemblyElementComposition",c.length),0==c.length){e.next=81;break}return e.next=41,this.getChildKeyElementsByAssemblyElement(this.props.activeRecord.recid);case 41:return u=e.sent,e.next=44,this.getChildAssemblyElementsByAssemblyElement(this.props.activeRecord.recid);case 44:d=e.sent,this.state.childKeyElements=u,this.state.childAssemblyElements=d,m=0;case 48:if(!(m<c.length)){e.next=81;break}if(console.log("assemblyElementComposition2",c),console.log("assemblyElementComposition2",c.length),h=c[m],f=null!=h.child_key_element,b=null!=h.child_assembly_element,!f){e.next=65;break}return t=a.find((function(e){return e.recid==h.child_key_element})),_=t.recname,y=u.filter((function(e){return e.key_element_code==h.child_key_element})),e.next=60,this.getAvailablePositionsByKeyElementOnAssemblyElement(r,h.child_key_element);case 60:g=e.sent,k=h.child_key_element,O=null,e.next=74;break;case 65:if(!b){e.next=74;break}return t=n.find((function(e){return e.recid==h.child_assembly_element})),_=t.recname,y=d.filter((function(e){return e.ke_node_type==h.child_assembly_element})),e.next=71,this.getAvailablePositionsByAssemblyElementOnAssemblyElement(r,h.child_assembly_element,o,s);case 71:g=e.sent,k=null,O=h.child_assembly_element;case 74:console.log("availablePositions",g.length),console.log("childElements",y.length),null!=g&&g.length>0?(S=g.map((function(e){return e.recname})),v=S.join(", ")):v=null,h.count&&h.count>0&&(l.push({keyElementTypeId:k,assemblyElementTypeId:O,positionsCount:h.count,usedPositionsCount:y.length,isFull:h.count===y.length,number:m+1,assemblyElementName:_,assemblyElementCountStr:y.length+" \u0438\u0437 "+h.count,assemblyElementAvailablePositions:v}),this.setStateTableData(l));case 78:m++,e.next=48;break;case 81:null!=l&&l.length>0?(this.setState({stateTableLoaded:!0}),this.props.updateStateTableLoaded(!0)):(this.setStateTableData([]),this.setState({stateTableLoaded:!1}),this.props.updateStateTableLoaded(!1)),this.setState({stateTableLoading:!1}),this.props.updateStateTableLoading(!1);case 84:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllKeyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_key_elements_codes?$filter=(recstate eq 1)");case 2:return t=e.sent,a=t.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllAssemblyElementTypes",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_ke_node_types?$filter=(recstate eq 1)");case 2:return t=e.sent,a=t.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,a=t.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return a=e.sent,n=a.value,e.abrupt("return",n.length>0?n[0]:null);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getChildAssemblyElementsByAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(t,")"));case 2:return a=e.sent,n=a.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAssemblyElementComposition",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_assembly_element_composition?$filter=(parent_assembly_element eq ".concat(t,") and (documentation_number eq ").concat(a,")"));case 2:return n=e.sent,s=n.value,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getChildKeyElementsByAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_node eq ".concat(t,")"));case 2:return a=e.sent,n=a.value,e.abrupt("return",n);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByKeyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n,s,l,r,o,i,c;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null!=t&&""!=t?" and (node_type eq ".concat(t,")"):"",e.next=3,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_node?$filter=(key_element_code eq ".concat(a,")").concat(n));case 3:if(s=e.sent,l=s.value,console.log("allPositions",l),null!=l||0!=l.length){e.next=8;break}return e.abrupt("return",null);case 8:for(r=[],o=[],console.log("allPositions2",l),i=this.state.childKeyElements,console.log("installedKeyElements",i),c=0;c<i.length;c++)null!=i[c].position_on_node&&r.push(i[c].position_on_node);if(this.state.options.length>0)for(c=0;c<this.state.options.length;c++)r.push(this.state.options[c].position);return(o=r.length>0?l.filter((function(e){return null==r.find((function(t){return t==e.recid}))})):l).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",o);case 18:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getAvailablePositionsByAssemblyElementOnAssemblyElement",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a,n,s){var l,r,o,i,c,u,d,m,h,f,b,_,y,g,v,k;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l="","cbb9d8cb-89ef-4b99-be77-a7d6e57e388e"!=t){e.next=7;break}return e.next=4,this.sendAuthorizedRequestAsync("/odata/dictionary_count_key_elements_by_node_type?$filter=(scheme eq ".concat(n,") and\n\t\t\t\t(ke_node_type eq ").concat(t,")"));case 4:r=e.sent,o=r.value[0],l=o.slider_body_count>2&&o.slider_cap_count>2?"and (for_six_axis_vagon eq ".concat(!0,")"):"and (for_four_axis_vagon eq ".concat(!0,")");case 7:return e.next=9,this.sendAuthorizedRequestAsync("/odata/dictionary_positions_on_parent_node?$filter=\n\t\t\t(child_node_type eq ".concat(a,") \n\t\t\tand (parent_node_type eq ").concat(t,") \n\t\t\t").concat(l));case 9:i=e.sent,c=i.value,u=[],d=[],m=[],h=Object(G.a)(c);try{for(h.s();!(f=h.n()).done;)null!=(b=f.value).node_position&&null==u.find((function(e){return e.recid==b.node_position}))&&null!=(_=s.find((function(e){return e.recid==b.node_position})))&&u.push(_)}catch(p){h.e(p)}finally{h.f()}if(null!=u||0!=u.length){e.next=18;break}return e.abrupt("return",null);case 18:for(y=this.state.childAssemblyElements,g=0;g<y.length;g++)null!=(v=y[g]).position_on_assembly_element&&d.push(v.position_on_assembly_element);if(this.state.options.length>0)for(g=0;g<this.state.options.length;g++)(k=this.state.options[g]).isKeyElement?null!=k.position&&k.positionObj.child_node_type==a&&d.push(k.positionObj.node_position):null!=k.position&&a==k.nodeObj.ke_node_type&&d.push(k.positionObj.recid);return(m=d.length>0?u.filter((function(e){return null==d.find((function(t){return t==e.recid}))})):u).sort((function(e,t){return e.recname.toLowerCase()<t.recname.toLowerCase()?-1:1})),e.abrupt("return",m);case 24:case"end":return e.stop()}}),e,this)})));return function(t,a,n,s){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateTableData",value:function(e){(console.log("setStateTableData",e),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance)&&this.refs.stateTableDataGrid.instance.option("dataSource",e)}},{key:"getStateTableData",value:function(){if(console.log("getStateTableData"),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance){var e=this.refs.stateTableDataGrid.instance.getDataSource();return null!=e?e.items():null}return null}},{key:"render",value:function(){return s.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},s.a.createElement(g.a,{md:"auto"},s.a.createElement(Z.a,{preloadEnabled:!1,name:this.props.field.name,selection:{mode:"single"},showBorders:!0,showColumnLines:!1,showRowLines:!0,hoverStateEnabled:!0,columnAutoWidth:!0,onCellPrepared:this.onCellPrepared,onSelectionChanged:this.onSelectionChanged,ref:"stateTableDataGrid"},s.a.createElement(W.Column,{width:"3%",dataField:"number",caption:"#",dataType:"number"}),s.a.createElement(W.Column,{width:"30%",dataField:"assemblyElementName",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435",dataType:"string"}),s.a.createElement(W.Column,{width:"10%",dataField:"assemblyElementCountStr",caption:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",dataType:"string"}),s.a.createElement(W.Column,{dataField:"assemblyElementAvailablePositions",caption:"\u0414\u043e\u0441\u0442\u0443\u043f\u043d\u044b\u0435 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",dataType:"string"})),s.a.createElement("div",{style:{marginTop:"30px"}},s.a.createElement(Y.a,{color:"success",isOpen:this.state.visible_alert},s.a.createElement("h4",{className:"alert-heading"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"),this.state.selectedRowNotes))))}},{key:"onSelectionChanged",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,l,r,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.selectedRowsData,"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0435\u0437 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445"!=(n=a[0]).nameke&&"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430"!=n.nameke&&"\u0422\u0435\u043b\u0435\u0436\u043a\u0430"!=n.nameke||(this.setState({is_circ:!0}),n.is_circ=!0),null==this.props.values.select_field.key_element_code){e.next=12;break}if(null==this.props.values.select_field.ke_node){e.next=11;break}return e.next=7,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.ke_node,")"));case 7:r=e.sent,l=s.a.createElement("b",null,r.value[0].ke_node_type_calculated," ",r.value[0].unique_number),e.next=12;break;case 11:l=s.a.createElement("b",null,this.props.values.select_field.key_element_code_calculated," ",this.props.values.select_field.numberke);case 12:if(null==this.props.values.select_field.ke_node_type){e.next=21;break}if(null==this.props.values.select_field.parent_ke_node){e.next=20;break}return e.next=16,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.parent_ke_node,")"));case 16:o=e.sent,l=s.a.createElement("b",null,o.value[0].ke_node_type_calculated," ",o.value[0].unique_number),e.next=21;break;case 20:l=s.a.createElement("b",null,this.props.values.select_field.ke_node_type_calculated," ",this.props.values.select_field.unique_number);case 21:i=s.a.createElement("p",null,"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0432\u0430\u0433\u043e\u043d\u0435 ",this.props.activeRecord.manufacturer_number," ",s.a.createElement("b",null,n.nameke," ",n.numberke)," \u043d\u0430 ",l),this.setState({visible_alert:!0,select_element:n,selectedRowNotes:i}),this.props.setFieldValue(this.props.field,n);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(n.Component),X=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),n.setState({selectedValue:e}),n.setState({option:e}),n.props.updateData(e,n.props.field.title)},n.handleChangeTemplate=function(e){console.log("handleChangeTemplate",e),n.setState({selectedValue:e}),n.props.setFieldValue(n.props.field,n.state.selectedValue),n.setState({option:e}),n.props.updateData(e)},n.state={option:"",currentElement:{},currentElementType:"",text_select:"",modalItems:[],selectedValue:""},n.getTemplates=n.getTemplates.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("componentDidMount"),e.next=3,this.getTemplates();case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getTemplates",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n,s=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],"select_field"!=this.props.field.name){e.next=6;break}return e.next=4,fetch("/odata/reestr_ke_node_types?$select=recname,recid,ke_node_type,assembly_element_type_calculated&$orderBy=recname&$filter=recstate eq 1",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(e){if(s.isNullOrEmptyResponse(e))return console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b");s.setState({modalItems:e.value})})).then((function(){return fetch("/odata/reestr_ke_nodes?$top=10&$select=reestr_ke_node_type,recid&$filter=(recstate eq 1) and (reestr_ke_node_type ne null)&$orderBy=reccreated desc",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}})})).then((function(e){return e.json()})).then((function(e){if(s.isNotEmptyOrNullArray(e.value))for(var t=0;t<e.value.length;t++)if(null!=e.value[t].reestr_ke_node_type){var a=s.state.modalItems.find((function(a){return a.recid==e.value[t].reestr_ke_node_type.toString()}));s.handleChangeTemplate(a);break}})).catch((function(e){return console.log("Request failed: ",e)}));case 4:e.next=48;break;case 6:if("select_template_plate_field"!=this.props.field.name){e.next=17;break}return e.next=9,this.sendRequestAsync("/odata/reestr_parts_type?$select=template_name,recid,key_element_code&$orderBy=recname&$filter=(recstate eq 1) and (key_element_code eq 8d6deb72-5c2e-4294-a289-01bd8a1d7f2f)");case 9:if(a=e.sent,!this.isNullOrEmptyResponse(a)){e.next=12;break}return e.abrupt("return",console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));case 12:n=a.value,t=n,this.setState({modalItems:t}),e.next=48;break;case 17:if("select_template_insert_field"!=this.props.field.name){e.next=28;break}return e.next=20,this.sendRequestAsync("/odata/reestr_parts_type?$select=template_name,recid,key_element_code&$orderBy=recname&$filter=(recstate eq 1) and (key_element_code eq f8f1d758-81a5-493d-8e9d-d5b4166dd34e)");case 20:if(a=e.sent,!this.isNullOrEmptyResponse(a)){e.next=23;break}return e.abrupt("return",console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));case 23:n=a.value,t=n,this.setState({modalItems:t}),e.next=48;break;case 28:if("select_template_ring_field"!=this.props.field.name){e.next=39;break}return e.next=31,this.sendRequestAsync("/odata/reestr_parts_type?$select=template_name,recid,key_element_code&$orderBy=recname&$filter=(recstate eq 1) and (key_element_code eq 8cdec5a2-69ac-4dd9-8568-f53853b55f86)");case 31:if(a=e.sent,!this.isNullOrEmptyResponse(a)){e.next=34;break}return e.abrupt("return",console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));case 34:n=a.value,t=n,this.setState({modalItems:t}),e.next=48;break;case 39:if("select_application_number_field"!=this.props.field.name){e.next=48;break}return e.next=42,this.sendRequestAsync("/odata/rfid_request?$select=application_number,recid&$orderBy=recname&$filter=(recstate eq 1) and (rfid_request_status eq 10 and actual_number ne null)");case 42:if(a=e.sent,!this.isNullOrEmptyResponse(a)){e.next=45;break}return e.abrupt("return",console.log("\u0428\u0430\u0431\u043b\u043e\u043d\u044b \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));case 45:n=a.value,t=n,this.setState({modalItems:t});case 48:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}},{key:"sendRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});case 2:return a=e.sent,console.log(a),e.next=6,a.json();case 6:return e.abrupt("return",e.sent);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){var e=this;return s.a.createElement(k.a,null,s.a.createElement(O.a,null,s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(C.a,{id:this.props.field,name:this.props.field.name,label:this.props.field.displayName,onChange:this.props.isTemplate?this.handleChangeTemplate:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",options:this.state.modalItems,getOptionLabel:function(t){return"select_field"==e.props.field.name?t.recname:"select_application_number_field"==e.props.field.name?t.application_number:t.template_name},getOptionValue:function(e){return e.recid},isClearable:!0,isSearchable:!0,value:this.state.selectedValue,styles:{control:function(e,t){var a=t.isFocused;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:"white",boxShadow:a?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:a?"#68a1be":"#e4e7ea",":hover":{borderColor:a?"#68a1be":"#e4e7ea"}})},option:function(e,t){var a=t.isDisabled,n=t.isFocused,s=t.isSelected;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:a?null:s?"#f5fafe":n?"#ecf5ff":null,color:"black"})}}}))}}]),a}(n.Component),ee=a(179),te=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={checkBoxValue:void 0},e.onValueChanged=e.onValueChanged.bind(Object(h.a)(e)),e}return Object(i.a)(a,[{key:"onValueChanged",value:function(e){this.setState({checkBoxValue:e.value}),this.props.setFieldValue(this.props.field,e.value),this.props.updateData(e.value)}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(ee.CheckBox,{name:this.props.field.name,onValueChanged:this.onValueChanged,text:this.props.field.text,defaultValue:!1}))}}]),a}(n.Component),ae=a(1361),ne=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),M.a.success(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(a,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return s.a.createElement($.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},s.a.createElement(H.a,null,s.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),s.a.createElement(ae.a,{animated:!0,value:"100"})))}}]),a}(n.Component),se=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=function(e){n.setState({value:e})},n.state={value:""},n}return Object(i.a)(a,[{key:"render",value:function(){var e=this;return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},s.a.createElement($.a,{isOpen:this.props.field.showModal,toggle:function(){return e.props.setFalseModalState()}},s.a.createElement(U.a,{toggle:function(){return e.props.setFalseModalState()}},"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438"),s.a.createElement(H.a,null,s.a.createElement(b.a,null,s.a.createElement(_.a,{size:"sm",type:"submit",color:"primary",onClick:this.handleOkModal},s.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",s.a.createElement(_.a,{size:"sm",onClick:function(){return e.props.setFalseModalState()}},s.a.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430")),s.a.createElement("hr",null),s.a.createElement(O.a,null,"\u041d\u043e\u043c\u0435\u0440"),s.a.createElement(S.a,{id:"number",value:null!=this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1]?this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1].label:"",readOnly:!0}),s.a.createElement("br",null),s.a.createElement(O.a,null,"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435"),s.a.createElement(S.a,{id:"element_name",value:null!=this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1]?this.props.field.uinGroupingElements[this.props.field.uinGroupingElements.length-1].title:"",readOnly:!0}),s.a.createElement("br",null),s.a.createElement(O.a,null,"\u041f\u043e\u0437\u0438\u0446\u0438\u044f"),console.log(this.props.field.positions.map((function(e){return{value:e,label:e.toString()}}))),s.a.createElement(C.a,{name:"testname",options:null!=this.props.field.positions?this.props.field.positions.map((function(e){return{value:e,label:e.toString()}})):null,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.value,onValueClick:function(t){return e.popupNotifyMessage(!0,t.value)}})))}}]),a}(n.Component),le=(a(222),[{title:"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445 \u0443\u0437\u043b\u043e\u0432",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u041f\u043e\u0434\u0448\u0438\u043f\u043d\u0438\u043a \u0431\u0443\u043a\u0441\u043e\u0432\u043e\u0433\u043e \u0443\u0437\u043b\u0430",current_quantity:0,necessary_quantity:2,available_positions:[1,2]},{title:"\u0417\u0430\u043c\u043e\u043a",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u0412\u0430\u043b\u0438\u043a \u043f\u043e\u0434\u044a\u0435\u043c\u043d\u0438\u043a\u0430",current_quantity:0,necessary_quantity:1,available_positions:null},{title:"\u041a\u043e\u0440\u043f\u0443\u0441 \u0430\u0432\u0442\u043e\u0441\u0446\u0435\u043f\u043a\u0438",current_quantity:0,necessary_quantity:1,available_positions:null}]);a(493);M.a.configure();var re=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={activeRecord:{}},e}return Object(i.a)(a,[{key:"componentWillMount",value:function(){console.log("activeRecord",window),null!=window.activeRecord?this.setState({activeRecord:window.activeRecord}):this.setState({activeRecord:{reccode:null,reccreated:"2020-10-20T11:38:42.320928+08:00",reccreatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",recdescription:null,recid:"9f46e82c-f027-49d3-b81c-f032f869c25a",recname:null,recstate:1,recupdated:"2020-10-23T00:49:34.77997+08:00",recupdatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",sysboolean_test:!1,sysdate_test:null,sysdecimal_test:null,sysenum_test:1,sysfile_test:null,sysimage_test:"",sysint_test:null,sysmoney_test:0,sysnumber_test:"\u0422\u0435\u0441\u0442\u043e\u0432\u043e\u0435 \u043e\u043a\u043d\u043e",sysstring_test:"",systime_test:null,systimedate_test:null}})}},{key:"render",value:function(){return s.a.createElement(oe,{method:{name:"test_procedure_update",displayName:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",isEnabled:null,isAnonymous:!1,static:!1,fields:[{name:"sysstring_field",type:"SysString",typeName:"SysString",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"sysint_field",type:"SysInt",typeName:"SysInt",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"checkbox_field",type:"SysBoolean",typeName:"SysBoolean",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"creatable_field",type:"SysString",typeName:"SysString",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:!0,default:null,lookup:null,searchLevel:null}],showModalYesNo:null,initMethodParams:null,isPacketSigned:null,workflow:null,table:"types_table"},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord})}}]),a}(n.Component),oe=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).updateTemplateForNode=function(t,a){switch(console.log("updateTemplateForNode",t),console.log("updateTemplateForNode",a),a){case"template_plate":e.setState({select_template_plate_field:t});break;case"template_insert":e.setState({select_template_insert_field:t});break;case"template_ring":e.setState({select_template_ring_field:t});break;case"application_number":e.setState({select_application_number_field:t})}},e.selectTemplate=function(t){e.setState({selected_template:t,is_pasported:!1,is_uin_data_empty:!0,count:1,uin_field_value:"",select_template_plate_field:null,select_template_insert_field:null,select_template_ring_field:null,select_application_number_field:null,stateTableLoaded:!1,stateTableLoading:!1}),e.clearFormik()},e.updateCount=function(t){e.setState({count:t}),e.clearFormik()},e.updateUinFieldValue=function(t){e.setState({uin_field_value:t})},e.updatePastprted=function(t){e.setState({is_pasported:t,is_uin_data_empty:!0,uin_field_value:"",count:1}),e.clearFormik()},e.updateUinFieldState=function(t){e.setState({is_uin_field_empty:t})},e.updateUinElementsFieldState=function(t){e.setState({is_uin_elements_field_empty:t})},e.updateUinState=function(){e.setState((function(e){return{is_uin_data_empty:e.is_uin_field_empty&&e.is_uin_elements_field_empty}}))},e.countingNumberParts=function(t){for(var a=0;a<e.state.selected_template.elements.length;a++)e.state.selected_template.elements[a].current_quantity=0;if(null!=t&&0!=t.length)for(var n=function(a){var n=e.state.selected_template.elements.find((function(e){return e.title==t[a].title}));null!=n&&n.current_quantity<n.necessary_quantity&&(n.current_quantity+=1)},s=0;s<t.length;s++)n(s)},e.updateGroupingElements=function(t){e.state.uin_grouping_elements.length<t.length&&e.setState({show_modal:!0}),e.setState({uin_grouping_elements:t})},e.updateStateTableLoaded=function(t){e.setState({stateTableLoaded:t})},e.updateStateTableLoading=function(t){e.setState({stateTableLoading:t})},e.setFalseModalState=function(){e.setState({show_modal:!1}),e.state.uin_grouping_elements.pop()},e.popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(n){console.log(n),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},e.state={selected_template:null,count:1,uin_field_value:"",is_pasported:!1,is_uin_field_empty:!0,is_uin_elements_field_empty:!0,is_uin_data_empty:!0,uin_grouping_elements:[],show_modal:!1,ref_data_grid:null,select_template_plate_field:null,select_template_insert_field:null,select_template_ring_field:null,select_application_number_field:null,processingAction:!1,isActionError:!1,successMessage:"",stateTableLoaded:!1,stateTableLoading:!1},e.selectTemplate=e.selectTemplate.bind(Object(h.a)(e)),e.updateCount=e.updateCount.bind(Object(h.a)(e)),e.updateUinFieldValue=e.updateUinFieldValue.bind(Object(h.a)(e)),e.updatePastprted=e.updatePastprted.bind(Object(h.a)(e)),e.updateUinFieldState=e.updateUinFieldState.bind(Object(h.a)(e)),e.updateUinElementsFieldState=e.updateUinElementsFieldState.bind(Object(h.a)(e)),e.updateUinState=e.updateUinState.bind(Object(h.a)(e)),e.countingNumberParts=e.countingNumberParts.bind(Object(h.a)(e)),e.updateGroupingElements=e.updateGroupingElements.bind(Object(h.a)(e)),e.setFalseModalState=e.setFalseModalState.bind(Object(h.a)(e)),e.dataGrid={},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.updateTemplateForNode=e.updateTemplateForNode.bind(Object(h.a)(e)),e.updateStateTableLoaded=e.updateStateTableLoaded.bind(Object(h.a)(e)),e.updateStateTableLoading=e.updateStateTableLoading.bind(Object(h.a)(e)),e}return Object(i.a)(a,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n,s,l,r,o,i,c,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),console.log("this",this),t="",this.state.is_pasported?(console.log(this.refs.formik.fields.uin_field.props.formik.values.uin_elements_field),a=this.refs.formik.fields.uin_field.props.formik.values.uin_elements_field,console.log(this.refs.formik.fields.uin_field.props.formik.values.uin_field),t=this.refs.formik.fields.uin_field.props.formik.values.uin_field):(a=this.refs.formik.fields.uin_elements_field.props.formik.values.uin_elements_field,console.log(this.refs.formik.fields.uin_elements_field.props.formik.values.uin_elements_field),t=this.refs.formik.fields.uin_elements_field.props.formik.values.uin_field,console.log(this.refs.formik.fields.uin_elements_field.props.formik.values.uin_field)),console.log(this.state.count),console.log(this.state.is_pasported),console.log(this.state.selected_template),console.log(this.state.select_template_plate_field),console.log(this.state.select_template_insert_field),console.log(this.state.select_template_ring_field),console.log(this.state.select_application_number_field),n=this.state.selected_template,s=this.state.select_template_plate_field,l=this.state.select_template_insert_field,r=this.state.select_template_ring_field,o=this.state.select_application_number_field,i={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null},"3607f67c-c619-43bd-bd9c-90acff9a5f28"!=this.state.selected_template.assembly_element_type_calculated){e.next=33;break}if("c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"!=this.state.selected_template.ke_node_type||!this.state.is_pasported){e.next=31;break}if(c=[],null==o&&c.push('\u041f\u043e\u043b\u0435 "\u041d\u043e\u043c\u0435\u0440 \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044f" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c'),null==r&&c.push('\u041f\u043e\u043b\u0435 "\u041a\u043e\u043b\u044c\u0446\u043e \u0432 \u043f\u043e\u0434\u043f\u044f\u0442\u043d\u0438\u043a" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c'),null==s&&c.push('\u041f\u043e\u043b\u0435 "\u041f\u043b\u0430\u0441\u0442\u0438\u043d\u044b \u0432 \u043a\u043b\u0438\u043d\u043e\u0432\u044b\u0445 \u043a\u0430\u0440\u043c\u0430\u043d\u0430\u0445" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c'),null==l&&c.push('\u041f\u043e\u043b\u0435 "\u0412\u0441\u0442\u0430\u0432\u043a\u0438 \u0432 \u043a\u043b\u0438\u043d\u043e\u0432\u044b\u0435 \u043a\u0430\u0440\u043c\u0430\u043d\u044b" \u043d\u0435 \u043c\u043e\u0436\u0435\u0442 \u0431\u044b\u0442\u044c \u043f\u0443\u0441\u0442\u044b\u043c'),!(c.length>0)){e.next=27;break}return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,"".concat(c.join())));case 27:i.body=JSON.stringify({numbers_pool:o.recid,pattern_for_saddle_ring:r.recid,pattern_for_wedge_pockets:s.recid,pattern_for_wedge_pockets_inserts:l.recid,pressure_beam_uin:t,reestr_ke_node_type:n.recid,is_passported:this.state.is_pasported,ke_node_type:this.state.selected_template.ke_node_type,assembly_element_type:this.state.selected_template.assembly_element_type_calculated}),console.log("createassemblyunitornodeelement",i),e.next=33;break;case 31:i.body=JSON.stringify({ke_numbers:a,reestr_ke_node_type:n.recid,assembly_element_type:this.state.selected_template.assembly_element_type_calculated,ke_node_type:this.state.selected_template.ke_node_type,is_passported:this.state.is_pasported}),console.log("createassemblyunitornodeelement",i);case 33:return"62b3559e-10da-4189-8b25-d558ba451ac8"==this.state.selected_template.assembly_element_type_calculated&&(i.body=JSON.stringify({unique_number:t,reestr_ke_node_type:n.recid,is_passported:this.state.is_pasported,ke_node_type:this.state.selected_template.ke_node_type,assembly_element_type:this.state.selected_template.assembly_element_type_calculated,ke_numbers:a,count:this.state.count}),console.log("createassemblyunitornodeelement",i)),e.next=36,this.sendRequestToOuterRdevAsync("/plugins/nbdlogicplugin/createassemblyunitornodeelement",i.body);case 36:if(!(u=e.sent).success){e.next=44;break}return this.setState({processingAction:!1}),window.closePluginModal(),1==this.state.count&&null!=u.data&&window.open("/tables/reestr_ke_nodes/".concat(u.data),"_self"),e.abrupt("return",this.popupNotifyMessage(!0,"".concat(u.message)));case 44:return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,"".concat(u.message)));case 46:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendRequestToOuterRdevAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:a});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"clearFormik",value:function(){console.log("formik",this.refs.formik),"undefined"!==typeof this.refs.formik.fields.uin_field.props.formik.values.uin_elements_field&&(this.refs.formik.fields.uin_field.props.formik.values.uin_elements_field=null),"undefined"!==typeof this.refs.formik.fields.uin_field.props.formik.values.uin_field&&(this.refs.formik.fields.uin_field.props.formik.values.uin_field=null),"undefined"!==typeof this.refs.formik.fields.uin_elements_field.props.formik.values.uin_elements_field&&(this.refs.formik.fields.uin_elements_field.props.formik.values.uin_elements_field=null),"undefined"!==typeof this.refs.formik.fields.uin_elements_field.props.formik.values.uin_field&&(this.refs.formik.fields.uin_elements_field.props.formik.values.uin_field=null)}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(v.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return s.a.createElement(v.b,{onSubmit:t.handleSubmit},s.a.createElement("h5",{class:"modal-title"},"\u0421\u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0421\u0427 \u0432 \u0443\u0437\u0435\u043b/\u0421\u0415"),s.a.createElement("hr",null),s.a.createElement(b.a,null,s.a.createElement(_.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",s.a.createElement(_.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),s.a.createElement("hr",null),s.a.createElement(y.a,{form:!0},s.a.createElement(g.a,null,s.a.createElement(v.a,{key:"select_type_field",name:"select_type_field"},(function(){return s.a.createElement(X,{setFieldValue:t.setFieldValue,updateData:e.selectTemplate,isTemplate:!0,field:{name:"select_field",displayName:"\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0444\u043e\u0440\u043c\u0438\u0440\u043e\u0432\u0430\u043d\u0438\u044f \u0443\u0437\u043b\u043e\u0432/\u0421\u0415",options:null}})}))),null!=e.state.selected_template&&s.a.createElement(g.a,{md:2},s.a.createElement(v.a,{key:"count_field",name:"count_field"},(function(){return s.a.createElement(B,{setFieldValue:t.setFieldValue,updateData:e.updateCount,field:{name:"count_field",displayName:"\u041a\u043e\u043b\u0438\u0447\u0435\u0441\u0442\u0432\u043e",isPasported:e.state.is_pasported,isUinDataEmpty:e.state.is_uin_data_empty,isAssemblyElement:"62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated,count:e.state.count}})})))),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&s.a.createElement(v.a,{key:"is_pasported",name:"is_pasported"},(function(){return s.a.createElement(te,{setFieldValue:t.setFieldValue,updateData:e.updatePastprted,field:{name:"is_pasported",text:"\u041a\u043e\u043c\u043f\u043b\u0435\u043a\u0442\u0443\u044e\u0449\u0438\u0435 \u043d\u0435 \u043f\u0430\u0441\u043f\u043e\u0440\u0442\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u044b"}})})),null!=e.state.selected_template&&("62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated||"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported)&&s.a.createElement(v.a,{key:"uin_field",name:"uin_field"},(function(){return s.a.createElement(L,{setFieldValue:t.setFieldValue,updateUinFieldValue:e.updateUinFieldValue,updateUinFieldState:e.updateUinFieldState,updateUinState:e.updateUinState,field:{name:"uin_field",displayName:"62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated?"\u0423\u0418\u041d":"\u0423\u0418\u041d \u0431\u0430\u043b\u043a\u0438 \u043d\u0430\u0434\u0440\u0435\u0441\u0441\u043e\u0440\u043d\u043e\u0439",isDisabled:1!=e.state.count,value:e.state.uin_field_value}})})),null!=e.state.selected_template&&("62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated||"22ca1065-868e-4726-8f52-b6a5fdb8dfdc"==e.state.selected_template.ke_node_type||"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&!e.state.is_pasported)&&s.a.createElement(v.a,{key:"uin_elements_field",name:"uin_elements_field"},(function(){return s.a.createElement(K,{setFieldValue:t.setFieldValue,updateUinElementsFieldState:e.updateUinElementsFieldState,updateUinState:e.updateUinState,updateGroupingElements:e.updateGroupingElements,updateModalState:e.updateModalState,refComponentDataGrid:e.dataGrid,field:{name:"uin_elements_field",displayName:"\u0423\u0418\u041d \u0434\u0435\u0442\u0430\u043b\u0435\u0439 \u0434\u043b\u044f \u0433\u0440\u0443\u043f\u043f\u0438\u0440\u043e\u0432\u043a\u0438",isUinElementsField:!0,isDisabled:1!=e.state.count||!e.state.stateTableLoaded||e.state.stateTableLoading,options:e.state.selected_template,selectedTemplate:e.state.selected_template}})})),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported&&s.a.createElement(v.a,{key:"select_template_plate_field",name:"select_template_plate_field"},(function(){return s.a.createElement(X,{setFieldValue:t.setFieldValue,updateData:e.updateTemplateForNode,field:{name:"select_template_plate_field",displayName:'\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0421\u0427 "\u041f\u043b\u0430\u0441\u0442\u0438\u043d\u044b \u0432 \u043a\u043b\u0438\u043d\u043e\u0432\u044b\u0445 \u043a\u0430\u0440\u043c\u0430\u043d\u0430\u0445"',title:"template_plate"}})})),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported&&s.a.createElement(v.a,{key:"select_template_insert_field",name:"select_template_insert_field"},(function(){return s.a.createElement(X,{setFieldValue:t.setFieldValue,updateData:e.updateTemplateForNode,field:{name:"select_template_insert_field",displayName:'\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0421\u0427 "\u0412\u0441\u0442\u0430\u0432\u043a\u0438 \u0432 \u043a\u043b\u0438\u043d\u043e\u0432\u044b\u0435 \u043a\u0430\u0440\u043c\u0430\u043d\u044b"',title:"template_insert"}})})),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported&&s.a.createElement(v.a,{key:"select_template_ring_field",name:"select_template_ring_field"},(function(){return s.a.createElement(X,{setFieldValue:t.setFieldValue,updateData:e.updateTemplateForNode,field:{name:"select_template_ring_field",displayName:'\u0428\u0430\u0431\u043b\u043e\u043d \u0434\u043b\u044f \u0421\u0427 "\u041a\u043e\u043b\u044c\u0446\u043e \u0432 \u043f\u043e\u0434\u043f\u044f\u0442\u043d\u0438\u043a"',title:"template_ring"}})})),null!=e.state.selected_template&&"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&e.state.is_pasported&&s.a.createElement(v.a,{key:"select_application_number_field",name:"select_application_number_field"},(function(){return s.a.createElement(X,{setFieldValue:t.setFieldValue,updateData:e.updateTemplateForNode,field:{name:"select_application_number_field",displayName:"\u041d\u043e\u043c\u0435\u0440 \u0437\u0430\u044f\u0432\u043b\u0435\u043d\u0438\u044f",title:"application_number"}})})),null!=e.state.selected_template&&("62b3559e-10da-4189-8b25-d558ba451ac8"==e.state.selected_template.assembly_element_type_calculated||"22ca1065-868e-4726-8f52-b6a5fdb8dfdc"==e.state.selected_template.ke_node_type||"c8c2ab90-8d32-41fc-8a4d-a969d13c9f04"==e.state.selected_template.ke_node_type&&!e.state.is_pasported)&&s.a.createElement(v.a,{key:"data_grid",name:"data_grid"},(function(a){var n=a.formikfield;a.form;return s.a.createElement(Q,Object.assign({value:e.props,field:{name:"data_grid",data:e.state.selected_template.recid},setFieldValue:t.setFieldValue,updateStateTableLoaded:e.updateStateTableLoaded,updateStateTableLoading:e.updateStateTableLoading,updateData:e.updateDataFromDataGrid,activeRecord:e.props.activeRecord,ref:function(t){return e.dataGrid=t}},t,n))})),s.a.createElement(v.a,{key:"modal_select_poition",name:"modal_select_poition"},(function(){return s.a.createElement(se,{setFieldValue:t.setFieldValue,setFalseModalState:e.setFalseModalState,field:{name:"modal_select_poition",displayName:"\u0412\u044b\u0431\u043e\u0440 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",showModal:e.state.show_modal,uinGroupingElements:e.state.uin_grouping_elements,positions:le[1].available_positions}})})))}}),s.a.createElement(ne,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}}]),a}(s.a.Component),ie=(a(948),a(528),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).handleChange=function(e){null!=e&&(console.log("handleChange",e),s.handleNewOptionClick(e))},s.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,l,r,o,i,c,u,d,m,h,f;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),a="",n="",l="",r="",o="",i=t.value,s.setState({isLoadingDetail:!0}),e.next=10,s.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(i,"')"));case 10:if(c=e.sent,!s.isNullOrEmptyResponse(c)){e.next=13;break}return e.abrupt("return",s.modalError("".concat("reestr_key_elements"==s.props.tableName?"\u0421\u043e\u0441\u0442\u0430\u0432\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c":"\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u0430\u044f \u0435\u0434\u0438\u043d\u0438\u0446\u0430 (\u0441\u043e\u0441\u0442\u0430\u0432\u043d\u0430\u044f \u0447\u0430\u0441\u0442\u044c)"," \u0441 \u0442\u0430\u043a\u0438\u043c \u0423\u0418\u041d \u043d\u0435 \u0441\u0443\u0449\u0435\u0441\u0442\u0432\u0443\u0435\u0442 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435")));case 13:return u=c.value[0],e.next=16,s.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(u.recid,")"));case 16:return d=e.sent,e.next=19,s.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(u.recid,") and (assembly_element_type eq 62b3559e-10da-4189-8b25-d558ba451ac8)"));case 19:if(m=e.sent,!s.isNullOrEmptyResponse(m)||!s.isNullOrEmptyResponse(d)){e.next=22;break}return e.abrupt("return",s.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 22:if(s.isNullOrEmptyResponse(d)||!s.isNullOrEmptyResponse(m)){e.next=52;break}if(o=d.value[0],a="reestr_key_elements",n=String().concat(o.numberke,", ",o.key_element_code_calculated),l=o.recid,r=o.key_element_code,"reestr_key_elements"==window.rdev_modalDataPack.tableName){e.next=48;break}if(null!=o.ke_node){e.next=33;break}return e.abrupt("return",s.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u0434\u043b\u044f ".concat(o.key_element_code_calculated,' \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b "\u0421\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0435 \u0447\u0430\u0441\u0442\u0438"')));case 33:if("c82c2eb8-0cf9-4693-8a2b-c6bf605c97ab"==o.statuske||"259762d5-2ee4-4acb-a2c7-18593cb6cc4f"==o.statuske){e.next=35;break}return e.abrupt("return",s.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442, \u0441\u0442\u0430\u0442\u0443\u0441 \u0434\u043e\u0447\u0435\u0440\u043d\u0435\u0439 \u0421\u0427 ".concat(o.key_element_code_calculated," ").concat(o.numberke," - ").concat(o.statuske_calculated)));case 35:return e.next=37,s.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(o.ke_node,")"));case 37:if(h=e.sent,!s.isNullOrEmptyResponse(h)){e.next=40;break}return e.abrupt("return",s.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 40:if("62b3559e-10da-4189-8b25-d558ba451ac8"==h.value[0].assembly_element_type){e.next=42;break}return e.abrupt("return",s.modalError("\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0445 \u0435\u0434\u0438\u043d\u0438\u0446 \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"));case 42:return e.next=44,s.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(o.ke_node,") and (assembly_element_type eq 62b3559e-10da-4189-8b25-d558ba451ac8)"));case 44:if(f=e.sent,!s.isNullOrEmptyResponse(f)){e.next=48;break}if("823cc6e9-465b-416e-beda-8a642149c235"==h.value[0].status||"25d67987-0cd4-404a-85d7-847d142af11f"==h.value[0].status){e.next=48;break}return e.abrupt("return",s.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u043d\u0430 ".concat(h.value[0].ke_node_type_calculated," ").concat(h.value[0].readonly_ke_node," \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 ").concat(h.value[0].status_calculated)));case 48:if("c82c2eb8-0cf9-4693-8a2b-c6bf605c97ab"==o.statuske||"259762d5-2ee4-4acb-a2c7-18593cb6cc4f"==o.statuske){e.next=50;break}return e.abrupt("return",s.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u043d\u0430 ".concat(o.key_element_code_calculated," ").concat(o.numberke," \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 ").concat(o.statuske_calculated)));case 50:e.next=64;break;case 52:if(s.isNullOrEmptyResponse(m)){e.next=64;break}if(o=m.value[0],a="reestr_ke_nodes",n=String().concat(o.unique_number,", ",o.ke_node_type_calculated),l=o.recid,r=o.ke_node_type,"reestr_ke_nodes"==window.rdev_modalDataPack.tableName){e.next=60;break}return e.abrupt("return",s.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u0434\u043b\u044f ".concat(m.value[0].ke_node_type_calculated,' \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b "\u0421\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0435 \u0435\u0434\u0438\u043d\u0438\u0446\u044b"')));case 60:if("823cc6e9-465b-416e-beda-8a642149c235"==o.status||"25d67987-0cd4-404a-85d7-847d142af11f"==o.status||"01d8f0ce-28db-4d3d-a956-38bb26260437"==o.status){e.next=62;break}return e.abrupt("return",s.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u043d\u0430 ".concat(o.ke_node_type_calculated," ").concat(o.readonly_ke_node," \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 ").concat(o.status_calculated)));case 62:if(null==o.vehicle){e.next=64;break}return e.abrupt("return",s.modalError("\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u043d\u0430 ".concat(o.ke_node_type_calculated," ").concat(o.readonly_ke_node," \u0432 \u0441\u0442\u0430\u0442\u0443\u0441\u0435 ").concat(o.status_calculated,", \u0442.\u043a. \u043e\u043d\u0430 \u0443\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u0430 \u043d\u0430 \u0432\u0430\u0433\u043e\u043d ").concat(o.vehicle_manufacturer_number)));case 64:t.label=n,s.setState({option:t,isLoadingDetail:!1}),s.props.setFieldValue(s.props.field.name,{label:n,recname:u.recname,recid:l,tableName:a,filterDefect:r}),s.props.updateUinState(),s.props.updateData({recname:u.recname,recid:l,tableName:a,filterDefect:r},o);case 69:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s.popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(n.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(n.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(s){console.log(s),M.a.error(n.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},s.prepareValue=function(){return s.props.value instanceof Array?s.props.value[0]:s.props.value},s.state={option:"",options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null},s.handleNewOptionClick=s.handleNewOptionClick.bind(Object(h.a)(s)),s.handleModalChange=s.handleModalChange.bind(Object(h.a)(s)),s.renderDeleteConfirm=s.renderDeleteConfirm.bind(Object(h.a)(s)),s}return Object(i.a)(a,[{key:"assemblyElementAlreadyExist",value:function(e,t){return 0==e.length||null==e.find((function(e){return null!=e.node&&null!=t&&e.node==t}))}},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&this.popupNotifyMessage(!1,e)}},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"getAllNodePositions",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/dictionary_node_positions?$filter=(recstate eq 1)");case 2:return t=e.sent,a=t.value,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAssemblyElementPattern",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendAuthorizedRequestAsync("/odata/reestr_ke_node_types?$filter=(recid eq ".concat(t,")"));case 2:return a=e.sent,n=a.value,console.log("getAssemblyElementPattern",n.length),e.abrupt("return",n.length>0?n[0]:null);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("deleteValue",t),this.setState({option:""}),this.props.setFieldValue(this.props.field.name,JSON.stringify(t)),this.props.updateData(null,null),this.setState({showDeleteModal:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return n.createElement($.a,{isOpen:this.state.showDeleteModal,size:"xl"},n.createElement(U.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),n.createElement(H.a,null,n.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),n.createElement(J.a,null,n.createElement(_.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},n.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),n.createElement(_.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},n.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;return n.createElement(k.a,{row:!0},n.createElement(O.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},n.createElement("b",null,this.props.field.displayName)),n.createElement(g.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},n.createElement(z.a,{name:this.props.field.name,components:{SingleValue:function(t){var a={backgroundColor:t.data.backgroundColor,color:t.data.color};return n.createElement("div",{className:"SelectValue",style:a},n.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t)}},"\xd7"),n.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,n.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.option,isMulti:!1,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,styles:{control:function(e,t){var a=t.isFocused;return Object(R.a)(Object(R.a)({},e),{},{boxShadow:a?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:a?"#68a1be":"#e4e7ea",":hover":{borderColor:a?"#68a1be":"#e4e7ea"}})},option:function(e,t){var a=t.isDisabled,n=t.isFocused,s=t.isSelected;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:a?null:s?"#f5fafe":n?"#ecf5ff":null,color:"black"})}}})),this.renderDeleteConfirm())}}]),a}(n.Component)),ce=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),n.setState({selectedValue:e}),n.props.setFieldValue(n.props.field,n.state.selectedValue),n.props.updateData(e,n.props.field.name)},n.state={options:[],uin:null,currentElement:{},currentElementType:"",text_select:"",selectedValue:null,fieldForShow:"recname"},n.getDictionaries=n.getDictionaries.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("state=",this.state),console.log("props=",this.props),console.log("componentDidMount"),this.getDictionaries(),this.props.field.isUinField&&(this.setState({uin:null!=this.props.field.uin?this.props.field:null}),null!=this.props.field.uin&&this.props.updateUinState(!1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(e){switch(console.log("prevProps=",e),console.log("props=",this.props),this.props.field.name){case"type_repair_field":break;case"type_fault_field":e.field.filterDefect!=this.props.field.filterDefect&&this.getDictionaries();break;case"repair_operation_field":e.field.filterOperation!=this.props.field.filterOperation&&this.getDictionaries()}}},{key:"getDictionaries",value:function(){var e=this;console.log("loadRepairTypes");var t="",a="",n="",s="";switch(this.props.field.name){case"type_repair_field":t="dictionary_type_work",this.setState({fieldForShow:"type_repair_work"}),a="type_repair_work";break;case"type_fault_field":if(this.setState({options:null}),this.setState({selectedValue:null}),t="dictionary_type_malfunction_pressure_beam",this.setState({fieldForShow:"recname"}),a="recname,name_key_element,name_ke_node",console.log("this.props.field.filterDefect",this.props.field.filterDefect),console.log("this.props.field.tableName",this.props.field.tableName),""==(n=null!=this.props.field.filterDefect&&""!=this.props.field.filterDefect?"reestr_key_elements"==this.props.field.tableName?"name_key_element eq ".concat(this.props.field.filterDefect," and "):"name_ke_node eq ".concat(this.props.field.filterDefect," and "):""))return this.setState({options:null}),void this.setState({selectedValue:null});break;case"repair_operation_field":if(t="dictionary_type_work_performed",this.setState({selectedValue:null,fieldForShow:"recname"}),console.log("this.props.field.filterOperation",this.props.field.filterOperation),a="work_performed_type,work_performed_type_operation",s="work_performed_type_operationitem($select=repair_operation)",""==(n=null!=this.props.field.filterOperation&&""!=this.props.field.filterOperation?"work_performed_type eq ".concat(this.props.field.filterOperation," and "):""))return this.setState({options:null}),void this.setState({selectedValue:null});break;case"uin_relation_field":a="reestr_key_elements"==(t=this.props.tableName)?"key_element_code,numberke":"unique_number,ke_node_type",n="recid eq ".concat(this.props.activeRecord.recid," and "),s="reestr_key_elements"==t?"key_element_codeitem($select=recname)":"ke_node_typeitem($select=recname)"}console.log("/odata/".concat(t,"?$select=").concat(a,",recid&$orderBy=").concat(a,"&$filter=").concat(n,"recstate eq 1&$expand=").concat(s)),fetch("/odata/".concat(t,"?$select=").concat(a,",recid&$orderBy=").concat(a,"&$filter=").concat(n,"recstate eq 1&$expand=").concat(s),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(a){if(e.isNullOrEmptyResponse(a))return console.log("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0430 ".concat(t," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));if("repair_operation_field"==e.props.field.name&&a.value.forEach((function(e){return e.recname=e.work_performed_type_operationitem.repair_operation})),"uin_relation_field"==e.props.field.name){console.log("uin response",a.value);var n={recid:a.value[0],recname:"reestr_key_elements"==t?"".concat(a.value[0].numberke,", ").concat(a.value[0].key_element_codeitem.recname):"".concat(a.value[0].unique_number,", ").concat(a.value[0].ke_node_typeitem.recname)};e.setState({selectedValue:n}),e.props.updateData(a.value[0],e.props.field.name)}else e.setState({options:a.value}),console.log("loadRepairTypes data.value ",a.value)})).catch((function(e){console.log("Request failed: ",e)}))}},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){var e=this;return s.a.createElement(k.a,{row:!0},s.a.createElement(O.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(g.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},s.a.createElement(C.a,{id:this.props.field,name:this.props.field,getOptionLabel:function(t){return t[e.state.fieldForShow]},getOptionValue:function(e){return e.recid},options:this.state.options,onChange:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",className:"basic-single",classNamePrefix:"select",value:this.state.selectedValue,isClearable:!0,isSearchable:!0,isDisabled:this.props.field.isUinField||this.props.field.isDisabled,styles:{control:function(e,t){var a=t.isFocused;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:"white",boxShadow:a?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:a?"#68a1be":"#e4e7ea",":hover":{borderColor:a?"#68a1be":"#e4e7ea"}})},option:function(e,t){var a=t.isDisabled,n=t.isFocused,s=t.isSelected;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:a?null:s?"#f5fafe":n?"#ecf5ff":null,color:"black"})}}})))}}]),a}(n.Component);M.a.configure();var ue=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(n){console.log(n),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},n.state={selectedRowNotes:"",notFoundAssemblyUnits:!1,isNeedShowDataGrid:!1},n.onSelectionChanged=n.onSelectionChanged.bind(Object(h.a)(n)),n.loadStateTable=n.loadStateTable.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("componentDidMount data grid",this.props),null==this.props.activeRecord){e.next=4;break}return e.next=4,this.loadStateTable(this.props.activeRecord);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(m.a)(p.a.mark((function e(t){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("data grid ",this.props),this.props.activeRecord===t.activeRecord||null==this.props.activeRecord){e.next=5;break}return e.next=4,this.loadStateTable(this.props.activeRecord);case 4:case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"loadStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("loadStateTable",t),e.next=3,this.getData(t);case 3:a=e.sent,this.setStateTableData(a);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateTableData",value:function(e){null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance&&this.refs.stateTableDataGrid.instance.option("dataSource",e)}},{key:"getStateTableData",value:function(){if(console.log("getStateTableData",this.props),console.log("getStateTableData",this.refs),null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance){var e=this.refs.stateTableDataGrid.instance.getDataSource();return null!=e?e.items():null}return null}},{key:"getAllChildAssemblyUnits",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n=this;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("getAllChildAssemblyUnits",t),void 0!=t&&null!=t){e.next=3;break}return e.abrupt("return",a);case 3:return e.next=5,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(parent_ke_node eq ".concat(t.recid,") and (recstate eq 1)"));case 5:return e.sent.value.forEach((function(e){if("62b3559e-10da-4189-8b25-d558ba451ac8"==e.assembly_element_type)return a.push(e),n.getAllChildAssemblyUnits(e,a)})),e.abrupt("return",a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"getMainParentAssemblyUnits",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.parent_ke_node,") and (recstate eq 1)"));case 2:if(void 0!=(a=e.sent).value[0]&&null!=a.value[0]){e.next=5;break}return e.abrupt("return",this.popupNotifyMessage(!1,"\u041e\u0448\u0438\u0431\u043a\u0430 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u044f \u0437\u0430\u043f\u0438\u0441\u0438 \u0421\u0415."));case 5:if(null==a.value[0].parent_ke_node||""==a.value[0].parent_ke_node){e.next=11;break}return e.next=8,this.getMainParentAssemblyUnits(a.value[0]);case 8:return e.abrupt("return",e.sent);case 11:return e.abrupt("return",a.value[0]);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getData",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,s,l,r,o,i,c,u;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t,console.log("date grid get data",a),e.next=4,this.sendRequestAsync("/odata/reestr_key_elements?$filter=(recid eq ".concat(a.recid,")"));case 4:return n=e.sent,e.next=7,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(a.recid,")"));case 7:if(s=e.sent,!this.isNullOrEmptyResponse(s)||!this.isNullOrEmptyResponse(n)){e.next=10;break}return e.abrupt("return",this.popupNotifyMessage(!1,"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 10:if(l=[],r=[],o=null,this.isNullOrEmptyResponse(n)||!this.isNullOrEmptyResponse(s)){e.next=24;break}if(null==a.ke_node){e.next=23;break}return e.next=17,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(a.ke_node,")"));case 17:if(i=e.sent,"62b3559e-10da-4189-8b25-d558ba451ac8"==(o=i.value[0]).assembly_element_type){e.next=21;break}return e.abrupt("return",this.popupNotifyMessage(!1,"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0445 \u0435\u0434\u0438\u043d\u0438\u0446 \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"));case 21:e.next=24;break;case 23:return e.abrupt("return",this.popupNotifyMessage(!1,"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0437\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442 \u0434\u043b\u044f ".concat(a.key_element_code_calculated,', \u0434\u043b\u044f \u044d\u0442\u043e\u0433\u043e \u043f\u0435\u0440\u0435\u0439\u0434\u0438\u0442\u0435 \u0432 \u0440\u0430\u0437\u0434\u0435\u043b "\u0421\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0435 \u0447\u0430\u0441\u0442\u0438".')));case 24:if(!this.isNullOrEmptyResponse(n)||this.isNullOrEmptyResponse(s)){e.next=32;break}if(void 0==s.value[0].parent_ke_node||null==s.value[0].parent_ke_node){e.next=31;break}return e.next=28,this.getMainParentAssemblyUnits(s.value[0]);case 28:o=e.sent,e.next=32;break;case 31:o=s.value[0];case 32:return r.push(o),e.next=35,this.getAllChildAssemblyUnits(o,r);case 35:for(console.log("allNodes=",r),c=0;c<r.length;c++)("823cc6e9-465b-416e-beda-8a642149c235"==(u=r[c]).status||"25d67987-0cd4-404a-85d7-847d142af11f"==u.status||"01d8f0ce-28db-4d3d-a956-38bb26260437"==u.status&&null==u.vehicle&&"62b3559e-10da-4189-8b25-d558ba451ac8"==u.assembly_element_type)&&l.push({uin:u.unique_number,title:u.ke_node_type_calculated,recid:u.recid});return l.length<=0?this.setState({notFoundAssemblyUnits:!0,selectedRowNotes:"\u041d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u044b\u0445 \u0435\u0434\u0438\u043d\u0438\u0446 \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"}):this.isNullOrEmptyResponse(s)||1!=l.length?(this.setState({isNeedShowDataGrid:!0}),this.props.updateDataGridNeed(!0)):(this.setState({notFoundAssemblyUnits:!1,isNeedShowDataGrid:!1}),this.props.updateDataGridNeed(!1)),e.abrupt("return",l);case 39:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"onSelectionChanged",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,s;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.selectedRowsData,n=a[0],console.log("onSelectionChanged data",n),void 0==n||null==n){e.next=10;break}return e.next=6,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(n.recid,")"));case 6:s=e.sent,this.props.updateData(n,s.value[0]),e.next=11;break;case 10:this.props.updateData(null,null);case 11:this.props.setFieldValue(this.props.field,n);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){return s.a.createElement(k.a,{row:!0,className:"justify-content-md-center",hidden:!this.state.isNeedShowDataGrid},s.a.createElement(O.a,{sm:4,hidden:!this.state.isNeedShowDataGrid,style:{flex:"0 0 30%",maxWidth:"30%"}}),s.a.createElement(g.a,{sm:8,style:{flex:"0 0 70%",maxWidth:"70%"}},s.a.createElement("p",null,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0443\u044e \u0435\u0434\u0438\u043d\u0438\u0446\u0443 \u0434\u043b\u044f \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"),s.a.createElement(Z.a,{preloadEnabled:!1,name:this.props.field,selection:{mode:"single"},showBorders:!0,showColumnLines:!0,showRowLines:!0,hoverStateEnabled:!0,columnAutoWidth:!0,visible:!this.state.notFoundAssemblyUnits&&this.state.isNeedShowDataGrid,onSelectionChanged:this.onSelectionChanged,ref:"stateTableDataGrid"},s.a.createElement(W.Column,{dataField:"uin",caption:"\u0423\u0418\u041d",dataType:"string"}),s.a.createElement(W.Column,{dataField:"title",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u043e\u0439 \u0435\u0434\u0438\u043d\u0438\u0446\u044b",dataType:"string"}),s.a.createElement(W.Column,{dataField:"recid",caption:"Guid \u0437\u0430\u043f\u0438\u0441\u0438 \u0421\u0427/\u0421\u0415",width:0,dataType:"string",visible:!1})),s.a.createElement("div",{style:{marginTop:"30px"}},s.a.createElement(Y.a,{color:"danger",isOpen:this.state.notFoundAssemblyUnits&&this.state.isNeedShowDataGrid},s.a.createElement("h4",{className:"alert-heading"},this.state.selectedRowNotes)))))}}]),a}(n.Component),de=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),M.a.success(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(a,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return s.a.createElement($.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},s.a.createElement(H.a,null,s.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),s.a.createElement(ae.a,{animated:!0,value:"100"})))}}]),a}(n.Component),pe=a(295),me=a(206),he=a.n(me),fe=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=function(e){if(console.log("date change"),null!=e.value){he()().utcOffset();var t=he()(e.value),a=new Date(Date.UTC(t.year(),t.month(),t.date()));n.setState({selectedValue:a}),n.props.setFieldValue(n.props.field.name,a)}else n.setState({selectedValue:null}),n.props.setFieldValue(n.props.field.name,e.value);n.props.setFieldTouched(n.props.field.name,!0),n.props.updateData(e.value,n.props.field.name)},n.getType=function(){return"SysTimeDate"===n.props.field.type?"datetime":"SysDate"===n.props.field.type?"date":"datetime"},n.state={selectedValue:new Date},n.handleChange=n.handleChange.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",elementAttr:{class:"rdev-read-only-control"}},s.a.createElement(k.a,{key:"input_".concat(this.props.field.name),row:!0},s.a.createElement(O.a,{sm:4,style:{flex:"0 0 30%",maxWidth:"30%"}},s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(g.a,{sm:8,style:{flex:"0 0 70%",maxWidth:"70%"}},s.a.createElement(pe.DateBox,{className:"repairFormDateBox",width:"100%",type:"date",id:this.props.field,name:this.props.field.name,defaultValue:new Date,showClearButton:!0,useMaskBehavior:!0,displayFormat:"dd.MM.yyyy",onValueChanged:this.handleChange,value:this.state.selectedValue})))}}]),a}(n.Component);M.a.configure();var be=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={activeRecord:null,tableName:"",place:"",isNeedDataGrid:!1},e}return Object(i.a)(a,[{key:"componentWillMount",value:function(){console.log("rdev_modalDataPack",window.rdev_modalDataPack),"edit"==window.rdev_modalDataPack.place?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords}):window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords[0]}):this.setState({activeRecord:null,isNeedDataGrid:!0}),this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place}),console.log("active=",window.rdev_modalDataPack.selectedRecords)}},{key:"render",value:function(){return s.a.createElement(_e,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},place:this.state.place,tableName:this.state.tableName,initialValues:{},activeRecord:this.state.activeRecord,isNeedDataGrid:this.state.isNeedDataGrid})}}]),a}(n.Component),_e=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).updateSelectedValues=function(t,a){switch(a){case"uin_relation_field":e.setState({selectedRecord:e.props.activeRecord,selectedElementType:"reestr_key_elements"==e.props.tableName?t.key_element_code:t.ke_node_type}),e.updateUinState(!1);break;case"type_repair_field":e.setState({selectedRepairType:t}),e.updateTypeRepairState(t);break;case"type_fault_field":e.setState({selectedFaultType:t});break;case"repair_operation_field":e.setState({selectedRepairOperation:t})}},e.updateTypeRepairState=function(t){e.isNotNullObject(t)?e.setState({is_type_repair_empty:!1}):(e.setState({is_type_repair_empty:!0}),e.setState({selectedRepairOperation:null}),console.log("state selectedRepairOperation",e.state))},e.updateSelectedDate=function(t,a){console.log("updateSelectedDate ",t),e.setState({selectedRepairDate:t})},e.updateselectedRecord=function(t,a){console.log("updateselectedRecord ",t),null!=t&&null!=a?e.setState({activeRecord:a,selectedRecord:a,selectedElementType:t.filterDefect,selectedTable:t.tableName,isVisibleDataGrid:!!t}):(e.setState({activeRecord:a,selectedRecord:a,selectedElementType:t,selectedTable:t,isVisibleDataGrid:t}),e.setState({selectedFaultType:t}),e.setState({is_uin_creatable_lookup_empty:!0}),e.setState({is_uin_empty:!0}),console.log("this.state_test",e.state))},e.updateDataFromDataGrid=function(t,a){null!=t?e.setState({selectedRecord:a,selectedRow:t,selectedElementType:null!=a?a.ke_node_type:null}):e.setState({selectedRow:null,selectedElementType:null}),console.log("updateDataFromDataGrid",e.state)},e.updateDataGridNeed=function(t){e.setState({isVisibleDataGrid:t})},e.updateUinCreatableLookupState=function(t){null!=t&&t.length>0?e.setState({is_uin_creatable_lookup_empty:!1}):e.setState({is_uin_creatable_lookup_empty:!0})},e.updateUinElementsFieldState=function(t){e.setState({is_uin_elements_field_empty:t})},e.updateUinState=function(t){e.setState({is_uin_empty:t})},e.popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(n){console.log(n),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},e.state={selectedRepairType:null,selectedFaultType:null,selectedRepairOperation:null,selectedRepairDate:new Date,selectedRecord:null,selectedRow:null,selectedTable:"",selectedElementType:"",isVisibleDataGrid:!1,inputRecord:null,uin:null,is_type_repair_empty:!0,is_uin_creatable_lookup_empty:!0,is_uin_empty:!0,processingAction:!1,ref_data_grid:null},e.updateTypeRepairState=e.updateTypeRepairState.bind(Object(h.a)(e)),e.updateUinCreatableLookupState=e.updateUinCreatableLookupState.bind(Object(h.a)(e)),e.updateUinState=e.updateUinState.bind(Object(h.a)(e)),e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.dataGrid={},e.updateUinElementsFieldState=e.updateUinElementsFieldState.bind(Object(h.a)(e)),e.updateSelectedValues=e.updateSelectedValues.bind(Object(h.a)(e)),e.updateSelectedDate=e.updateSelectedDate.bind(Object(h.a)(e)),e.updateselectedRecord=e.updateselectedRecord.bind(Object(h.a)(e)),e.updateDataFromDataGrid=e.updateDataFromDataGrid.bind(Object(h.a)(e)),e.updateDataGridNeed=e.updateDataGridNeed.bind(Object(h.a)(e)),e}return Object(i.a)(a,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(this.refs.formik.fields),console.log(this.refs.formik.state.values),console.log(this.state),this.setState({processingAction:!0}),t="",console.log("selectedRecordvselectedRecord",this.state.selectedRecord),console.log("tableName",this.props.tableName),console.log("selectedRow",this.state.selectedRow),this.isNullObject(this.state.selectedRecord)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0423\u0418\u041d". ')),this.props.isNeedDataGrid&&this.state.isVisibleDataGrid&&"reestr_ke_nodes"==this.props.tableName&&this.isNullObject(this.state.selectedRow)&&(t=String().concat(t,"\u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d\u0430 \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0430\u044f \u0435\u0434\u0438\u043d\u0438\u0446\u0430. ")),"undefined"!==this.state.selectedRepairDate&&null!=this.state.selectedRepairDate||(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0414\u0430\u0442\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430". ')),this.isNullObject(this.state.selectedRepairType)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0412\u0438\u0434 \u0440\u0435\u043c\u043e\u043d\u0442\u0430". ')),this.isNullObject(this.state.selectedFaultType)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0412\u0438\u0434 \u043d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u043e\u0441\u0442\u0438". ')),this.isNullObject(this.state.selectedRepairOperation)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u044f \u0440\u0435\u043c\u043e\u043d\u0442\u0430". ')),!this.isNotEmptyString(t)){e.next=19;break}return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,t));case 19:return a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({recid:this.isNotNullObject(this.state.selectedRecord)?this.state.selectedRecord.recid:this.props.activeRecord.recid,table_name:this.props.tableName,repair_date:this.state.selectedRepairDate,repair_type:this.state.selectedRepairType.type_repair_work,repair_defect:this.state.selectedFaultType.recname,repair_operation:this.state.selectedRepairOperation.recname})},console.log("requestBody",a),e.next=23,this.sendRequestToOuterRdevAsync("/plugins/nbdlogicplugin/registerrepair",a.body);case 23:if(n=e.sent,console.log("result_registerrepair_resp",n),!n.success){e.next=31;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",this.popupNotifyMessage(!0,"".concat(n.message)));case 31:return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,"".concat(n.message)));case 33:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(v.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return s.a.createElement(v.b,{onSubmit:t.handleSubmit},s.a.createElement("h5",{class:"modal-title"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0440\u0435\u043c\u043e\u043d\u0442"),s.a.createElement("hr",null),null!=e.props.activeRecord&&s.a.createElement(v.a,{key:"uin_relation_field",name:"uin_relation_field"},(function(){return s.a.createElement(ce,{setFieldValue:t.setFieldValue,updateUinState:e.updateUinState,updateData:e.updateSelectedValues,field:{name:"uin_relation_field",displayName:"\u0423\u0418\u041d",options:null,isUinField:!0},activeRecord:e.props.activeRecord,tableName:e.props.tableName})})),null==e.props.activeRecord&&s.a.createElement(v.a,{key:"uin_creatable_lookup_field",name:"uin_creatable_lookup_field"},(function(){return s.a.createElement(ie,{setFieldValue:t.setFieldValue,updateData:e.updateselectedRecord,updateUinElementsFieldState:e.updateUinElementsFieldState,updateUinState:e.updateUinState,updateGroupingElements:e.updateGroupingElements,updateModalState:e.updateModalState,refComponentDataGrid:e.dataGrid,field:{name:"uin_creatable_lookup_field",displayName:"\u0423\u0418\u041d",isUinElementsField:!0},tableName:e.props.tableName})})),"reestr_ke_nodes"==e.props.tableName&&e.state.isVisibleDataGrid&&e.props.isNeedDataGrid&&s.a.createElement(v.a,{key:"data_grid",name:"data_grid"},(function(a){var n=a.formikfield;a.form;return s.a.createElement(ue,Object.assign({value:e.props,field:"data_grid",setFieldValue:t.setFieldValue,updateData:e.updateDataFromDataGrid,updateDataGridNeed:e.updateDataGridNeed,activeRecord:e.state.activeRecord,selectedRecord:e.state.selectedRecord,tableName:e.props.tableName,ref:function(t){return e.dataGrid=t}},t,n))})),s.a.createElement(v.a,{key:"date_field",name:"date_field"},(function(){return s.a.createElement(fe,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedDate,field:{name:"date_field",displayName:"\u0414\u0430\u0442\u0430 \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0438 \u0440\u0435\u043c\u043e\u043d\u0442\u0430",isUinElementsField:!0}},t))})),s.a.createElement(v.a,{key:"type_repair_field",name:"type_repair_field"},(function(){return s.a.createElement(ce,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,field:{name:"type_repair_field",displayName:"\u0412\u0438\u0434 \u0440\u0435\u043c\u043e\u043d\u0442\u0430"}},t))})),s.a.createElement(v.a,{key:"type_fault_field",name:"type_fault_field"},(function(){return s.a.createElement(ce,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,field:{name:"type_fault_field",displayName:"\u0412\u0438\u0434 \u043d\u0435\u0438\u0441\u043f\u0440\u0430\u0432\u043d\u043e\u0441\u0442\u0438",isDisabled:e.state.is_uin_empty&&e.state.is_uin_creatable_lookup_empty&&("reestr_ke_nodes"!=e.props.tableName||null==e.state.selectedRow),filterDefect:null!=e.state.selectedRecord?e.state.selectedElementType:"",tableName:e.props.tableName}},t))})),s.a.createElement(v.a,{key:"repair_operation_field",name:"repair_operation_field"},(function(){return s.a.createElement(ce,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,field:{name:"repair_operation_field",displayName:"\u041e\u043f\u0435\u0440\u0430\u0446\u0438\u044f \u0440\u0435\u043c\u043e\u043d\u0442\u0430",isDisabled:e.state.is_type_repair_empty,filterOperation:null!=e.state.selectedRepairType?e.state.selectedRepairType.recid:"",tableName:e.props.tableName}},t))})),s.a.createElement("hr",null),s.a.createElement(b.a,null,s.a.createElement(_.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0"))}}),s.a.createElement(de,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}))}},{key:"sendRequestToOuterRdevAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:a});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"isEmptyString",value:function(e){return null==e||"undefined"===e||""===e||0===e.length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotNullObject",value:function(e){return null!=e&&"undefined"!==e&&e&&0!==Object.keys(e).length}},{key:"isEmptyOrNullArray",value:function(e){return!e||null==e||"undefined"===e||e.length<=0}},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}}]),a}(s.a.Component),ye=(a(1339),n.Component,n.Component,n.Component,n.Component,function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={checkBoxValue:void 0},e.onValueChanged=e.onValueChanged.bind(Object(h.a)(e)),e}return Object(i.a)(a,[{key:"onValueChanged",value:function(e){this.setState({checkBoxValue:e.value}),this.props.updateData(e.value),this.props.setFieldValue(this.props.field,e.value)}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(ee.CheckBox,{name:this.props.field,onValueChanged:this.onValueChanged,text:"\u041f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u044c \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0443\u044e \u0435\u0434\u0438\u043d\u0438\u0446\u0443 \u043e\u0442\u043d\u043e\u0441\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u043f\u0435\u0440\u0432\u043e\u043d\u0430\u0447\u0430\u043b\u044c\u043d\u043e\u0439 \u043f\u043e\u0437\u0438\u0446\u0438\u0438",defaultValue:!1}))}}]),a}(n.Component)),ge=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(n){console.log(n),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},n.state={selectedRowNotes:"",data:[],uin:"",elements_in_vagon:{},select_element:{},is_circ:!1,visible_alert:!1,name_old_element:"",name_new_element:null,isVisibleCheckbox:"hidden",marginTopCheckBox:"0px",marginTopAddMessage:"0px",additionMessage:"\u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u0441\u0431\u043e\u0440\u043e\u0447\u043d\u0430\u044f \u0435\u0434\u0438\u043d\u0438\u0446\u0430 \u0431\u044b\u043b\u0430 \u043f\u043e\u0432\u0435\u0440\u043d\u0443\u0442\u0430, \u0431\u0443\u0434\u0435\u0442 \u043f\u0440\u043e\u0438\u0437\u0432\u0435\u0434\u0435\u043d \u043f\u0435\u0440\u0435\u0441\u0447\u0435\u0442 \u0432\u0441\u0435\u0445 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0445 \u043f\u043e\u0437\u0438\u0446\u0438\u0439",isVisibleAdditionMessage:"hidden"},n.onSelectionChanged=n.onSelectionChanged.bind(Object(h.a)(n)),n.loadStateTable=n.loadStateTable.bind(Object(h.a)(n)),n.renderCheckBoxNbd=n.renderCheckBoxNbd.bind(Object(h.a)(n)),n.updateDataCheckBox=n.updateDataCheckBox.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidUpdate",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=this.props.values.select_field)){e.next=4;break}return e.next=4,this.loadStateTable(t);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"loadStateTable",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getData(t);case 2:a=e.sent,this.setStateTableData(a);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setStateTableData",value:function(e){null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance&&this.refs.stateTableDataGrid.instance.option("dataSource",e)}},{key:"getStateTableData",value:function(){if(null!=this.refs&&null!=this.refs.stateTableDataGrid&&null!=this.refs.stateTableDataGrid.instance){var e=this.refs.stateTableDataGrid.instance.getDataSource();return null!=e?e.items():null}return null}},{key:"getData",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,s,l,r,o,i,c,u,d,m,h,f,b,_;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=this.props.activeRecord.recid,e.next=3,this.sendRequestAsync("/odata/reestr_key_elements?$filter=(recid eq ".concat(t.recid,")"));case 3:return n=e.sent,e.next=6,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.recid,")"));case 6:if(s=e.sent,!this.isNullOrEmptyResponse(s)||!this.isNullOrEmptyResponse(n)){e.next=10;break}return this.popupNotifyMessage(!1,"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."),e.abrupt("return",A()({message:"\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435.",width:350,height:"auto",position:"bottom right",hoverStateEnabled:!1},"error",5500));case 10:if(l=null,r=[],this.isNullOrEmptyResponse(n)||!this.isNullOrEmptyResponse(s)){e.next=30;break}if(null==t.ke_node){e.next=25;break}return e.next=16,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.ke_node,")"));case 16:return o=e.sent,i=o.value[0],e.next=20,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(ke_node_type eq ".concat(i.ke_node_type,") and (vehicle eq ").concat(a,")"));case 20:for(l=e.sent,c=l.value,u=0;u<c.length;u++)d=c[u],r.push({numberke:d.unique_number,nameke:d.ke_node_type_calculated,position:d.assembly_element_position_on_vagon_calculated,recid:d.recid});e.next=30;break;case 25:return e.next=27,this.sendRequestAsync("/odata/reestr_key_elements?$filter=(key_element_code eq ".concat(t.key_element_code,") and (vehicle eq ").concat(a,")"));case 27:for(l=e.sent,c=l.value,m=0;m<c.length;m++)h=c[m],f=void 0,f="\u0421\u043c\u0435\u043d\u043d\u044b\u0439 \u0436\u0435\u043b\u0435\u0437\u043d\u043e\u0434\u043e\u0440\u043e\u0436\u043d\u044b\u0439 \u043a\u0443\u0437\u043e\u0432"==h.key_element_code_calculated?"1":h.position_on_vagon_calculated,r.push({numberke:h.numberke,nameke:h.key_element_code_calculated,position:f,recid:h.recid});case 30:if(!this.isNullOrEmptyResponse(n)||this.isNullOrEmptyResponse(s)){e.next=39;break}return e.next=33,this.findMainNode(t);case 33:return i=e.sent,e.next=36,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(ke_node_type eq ".concat(i.ke_node_type,") and (vehicle eq ").concat(a,")"));case 36:for(l=e.sent,c=l.value,b=0;b<c.length;b++)_=c[b],r.push({numberke:_.unique_number,nameke:_.ke_node_type_calculated,position:_.assembly_element_position_on_vagon_calculated,recid:_.recid});case 39:return e.abrupt("return",r);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sendRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"renderCheckBoxNbd",value:function(e){if(console.log("renderCheckBoxNbd_props_",e),console.log("renderCheckBoxNbd_props_",this.props),0!=this.state.is_circ)return s.a.createElement(ye,{value:this.props,field:"check_box_nbd",activeRecord:this.props.activeRecord})}},{key:"updateDataCheckBox",value:function(e){console.log("isCheck",e),e?this.setState({isVisibleAdditionMessage:"visible",marginTopAddMessage:"30px"}):this.setState({isVisibleAdditionMessage:"hidden",marginTopAddMessage:"0px"})}},{key:"render",value:function(){return s.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},s.a.createElement(g.a,{md:"auto"},s.a.createElement(O.a,null,s.a.createElement("b",null,"\u0412\u044b\u0431\u0435\u0440\u0438\u0442\u0435, \u0447\u0442\u043e \u043f\u043b\u0430\u043d\u0438\u0440\u0443\u0435\u0442\u0441\u044f \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c")),s.a.createElement(Z.a,{preloadEnabled:!1,name:this.props.field,selection:{mode:"single"},showBorders:!0,hoverStateEnabled:!0,columnAutoWidth:!0,onSelectionChanged:this.onSelectionChanged,ref:"stateTableDataGrid"},s.a.createElement(W.Column,{dataField:"numberke",caption:"\u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438",dataType:"string"}),s.a.createElement(W.Column,{dataField:"nameke",caption:"\u041d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438",dataType:"string"}),s.a.createElement(W.Column,{dataField:"position",caption:"\u041f\u043e\u0437\u0438\u0446\u0438\u044f \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438",dataType:"string"}),s.a.createElement(W.Column,{dataField:"is_circ",caption:"\u0412\u043e\u0437\u043c\u043e\u0436\u0435\u043d \u043f\u043e\u0432\u043e\u0440\u043e\u0442",width:0,dataType:"boolean",visible:!1}),s.a.createElement(W.Column,{dataField:"recid",caption:"Guid \u0437\u0430\u043f\u0438\u0441\u0438 \u0421\u0427/\u0421\u0415",width:0,dataType:"string",visible:!1})),s.a.createElement("div",{style:{marginTop:this.state.marginTopCheckBox,visibility:this.state.isVisibleCheckbox}},s.a.createElement(ye,{value:this.props,field:"check_box_nbd",setFieldValue:this.props.setFieldValue,activeRecord:this.props.activeRecord,updateData:this.updateDataCheckBox})),s.a.createElement("div",{style:{marginTop:"30px"}},s.a.createElement(Y.a,{color:"success",isOpen:this.state.visible_alert},s.a.createElement("h4",{className:"alert-heading"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"),this.state.selectedRowNotes,s.a.createElement("p",{style:{marginBottom:this.state.marginTopAddMessage,visibility:this.state.isVisibleAdditionMessage}},s.a.createElement("b",null,this.state.additionMessage))))))}},{key:"visibleCheckboxChanged",value:function(e){"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430 \u0431\u0435\u0437 \u0431\u0443\u043a\u0441\u043e\u0432\u044b\u0445 \u0443\u0437\u043b\u043e\u0432"==e.nameke||"\u041a\u043e\u043b\u0435\u0441\u043d\u0430\u044f \u043f\u0430\u0440\u0430"==e.nameke||"\u0422\u0435\u043b\u0435\u0436\u043a\u0430"==e.nameke?(this.setState({isVisibleCheckbox:"visible",marginTopCheckBox:"30px"}),console.log("selection_change",this.state)):(this.setState({isVisibleCheckbox:"hidden",marginTopCheckBox:"0"}),console.log("selection_change2",this.state))}},{key:"findMainNode",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t.parent_ke_node){e.next=7;break}return e.next=3,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t.parent_ke_node,")"));case 3:return a=e.sent,e.abrupt("return",this.findMainNode(a.value[0]));case 7:return e.abrupt("return",t);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onSelectionChanged",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,l,r,o,i;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.selectedRowsData,n=a[0],console.log("data",n),this.visibleCheckboxChanged(n),null==this.props.values.select_field.key_element_code){e.next=15;break}if(null==this.props.values.select_field.ke_node){e.next=13;break}return e.next=8,this.sendRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(this.props.values.select_field.ke_node,")"));case 8:o=e.sent,r=o.value[0],l=s.a.createElement(s.a.Fragment,null,s.a.createElement("b",null,r.ke_node_type_calculated," ",r.unique_number),", \u0432 \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043e ",s.a.createElement("b",null,this.props.values.select_field.key_element_code_calculated," ",this.props.values.select_field.numberke)),e.next=15;break;case 13:r=this.props.values.select_field,l=s.a.createElement("b",null,this.props.values.select_field.key_element_code_calculated," ",this.props.values.select_field.numberke);case 15:if(null==this.props.values.select_field.ke_node_type){e.next=20;break}return e.next=18,this.findMainNode(this.props.values.select_field);case 18:r=e.sent,l=null!=this.props.values.select_field.parent_ke_node?s.a.createElement(s.a.Fragment,null,s.a.createElement("b",null,r.ke_node_type_calculated," ",r.unique_number),", \u0432 \u043a\u043e\u0442\u043e\u0440\u0443\u044e \u0432\u043a\u043b\u044e\u0447\u0435\u043d\u043e ",s.a.createElement("b",null,this.props.values.select_field.ke_node_type_calculated," ",this.props.values.select_field.unique_number)):s.a.createElement("b",null,r.ke_node_type_calculated," ",r.unique_number);case 20:this.props.updateData(n,r.recid),i=s.a.createElement("p",null,"\u0412\u044b \u0441\u043e\u0431\u0438\u0440\u0430\u0435\u0442\u0435\u0441\u044c \u0437\u0430\u043c\u0435\u043d\u0438\u0442\u044c \u043d\u0430 \u0432\u0430\u0433\u043e\u043d\u0435 ",this.props.activeRecord.manufacturer_number," ",s.a.createElement("b",null,n.nameke," ",n.numberke)," \u043d\u0430 ",l),this.setState({visible_alert:!0,select_element:n,selectedRowNotes:i}),this.props.setFieldValue(this.props.field,n);case 24:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),a}(n.Component),ve=(a(1340),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=function(e){null!=e&&(console.log("handleChange",e),n.handleNewOptionClick(e))},n.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var a,s,l,r,o,i,c,u,d,m;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleNewOptionClick",t),n.setState({isLoadingDetail:!0}),a=t.value,e.next=5,n.sendAuthorizedRequestAsync("/odata/ke_numbers?$filter=(recname eq '".concat(a,"')"));case 5:if(s=e.sent,!n.isNullOrEmptyResponse(s)){e.next=9;break}return n.setState({isLoadingDetail:!1}),e.abrupt("return",n.modalError("\u0421\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u0423\u0418\u041d ".concat(a," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435")));case 9:return l=s.value[0],e.next=12,n.sendAuthorizedRequestAsync("/odata/reestr_key_elements?$filter=(ke_number eq ".concat(l.recid,")"));case 12:return r=e.sent,e.next=15,n.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(unique_number_relation eq ".concat(l.recid,")"));case 15:if(o=e.sent,!n.isNullOrEmptyResponse(o)||!n.isNullOrEmptyResponse(r)){e.next=19;break}return n.setState({isLoadingDetail:!1}),e.abrupt("return",n.modalError("\u041f\u043e \u0423\u0418\u041d ".concat(a," \u043d\u0435 \u0431\u044b\u043b\u043e \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0430\u0446\u0438\u0439 \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435.")));case 19:if(c=null,n.isNullOrEmptyResponse(r)||!n.isNullOrEmptyResponse(o)){e.next=34;break}if(null!=(c=r.value[0]).ke_node){e.next=28;break}i="".concat(c.numberke,", ").concat(c.key_element_code_calculated),n.setState({currentElementType:"key_element"}),u="",e.next=34;break;case 28:return e.next=30,n.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(c.ke_node,")"));case 30:d=e.sent,i="".concat(c.numberke,", ").concat(c.key_element_code_calculated),n.setState({currentElementType:"key_element"}),u="\u0412\u0445\u043e\u0434\u0438\u0442 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 ".concat(d.value[0].ke_node_type_calculated," ").concat(d.value[0].unique_number);case 34:if(!n.isNullOrEmptyResponse(r)||n.isNullOrEmptyResponse(o)){e.next=49;break}if(null!=(c=o.value[0]).parent_ke_node){e.next=42;break}i="".concat(c.unique_number,", ").concat(c.ke_node_type_calculated),n.setState({currentElementType:"assembly_element"}),u="",e.next=49;break;case 42:return e.next=44,n.getparentse(c.parent_ke_node);case 44:m=e.sent,console.log("parentAssemblyUnit",m),i="".concat(c.unique_number,", ").concat(c.ke_node_type_calculated),n.setState({currentElementType:"assembly_element"}),u="\u0412\u0445\u043e\u0434\u0438\u0442 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 ".concat(m.ke_node_type_calculated," ").concat(m.unique_number);case 49:return t.label=i,n.setState({option:t,currentElement:c,isLoadingDetail:!1}),n.setState({text_select:u}),n.props.updateData(!0),n.props.setFieldValue(n.props.field,n.state.currentElement),e.abrupt("return");case 55:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.getparentse=function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getparentse",t),e.next=3,n.sendAuthorizedRequestAsync("/odata/reestr_ke_nodes?$filter=(recid eq ".concat(t,")"));case 3:if(a=e.sent,console.log("getparentse",a),n.isNullOrEmptyResponse(a)){e.next=11;break}if(null==a.value[0].parent_ke_node){e.next=10;break}return e.abrupt("return",n.getparentse(a.value[0].parent_ke_node));case 10:return e.abrupt("return",a.value[0]);case 11:return e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),n.popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(n){console.log(n),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},n.state={option:"",currentElement:{},currentElementType:"",text_select:"\u0421\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0434\u043b\u044f \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u043a\u043e\u043c\u043f\u043b\u0435\u043a\u0442\u0430\u0446\u0438\u0438 \u0432\u0430\u0433\u043e\u043d\u0430",isLoadingDetail:!1},n.handleNewOptionClick=n.handleNewOptionClick.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"deleteValue",value:function(){this.setState({option:null}),this.setState({text_select:"\u0421\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0434\u043b\u044f \u043a\u043e\u0440\u0440\u0435\u043a\u0442\u0438\u0440\u043e\u0432\u043a\u0438 \u043a\u043e\u043c\u043f\u043b\u0435\u043a\u0442\u0430\u0446\u0438\u0438 \u0432\u0430\u0433\u043e\u043d\u0430"}),this.props.updateData(!1),this.props.setFieldValue(this.props.field,null)}},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&this.popupNotifyMessage(!1,e)}},{key:"render",value:function(){var e=this;return s.a.createElement(k.a,{row:!0,className:"justify-content-md-center"},s.a.createElement(g.a,{sm:4},s.a.createElement(O.a,{for:"creatable"},s.a.createElement("b",null,"\u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438"))),s.a.createElement(g.a,{sm:8},s.a.createElement(z.a,{id:"creatable",name:this.props.field,components:{SingleValue:function(t){var a={backgroundColor:t.data.backgroundColor,color:t.data.color};return s.a.createElement("div",{className:"SelectValue",style:a},s.a.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.deleteValue()}},"\xd7"),s.a.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,s.a.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.option,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isMulti:!1,isClearable:!1,isLoading:this.state.isLoadingDetail,isDisabled:this.state.isLoadingDetail,styles:{control:function(e,t){var a=t.isFocused;return Object(R.a)(Object(R.a)({},e),{},{boxShadow:a?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:a?"#68a1be":"#e4e7ea",":hover":{borderColor:a?"#68a1be":"#e4e7ea"}})},option:function(e,t){var a=t.isDisabled,n=t.isFocused,s=t.isSelected;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:a?null:s?"#f5fafe":n?"#ecf5ff":null,color:"black"})}}}),s.a.createElement(E.a,{className:"text-muted"},this.state.text_select)))}}]),a}(n.Component)),ke=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),M.a.success(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(a,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?this.setState({waiting:!1}):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return s.a.createElement($.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},s.a.createElement(H.a,null,s.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),s.a.createElement(ae.a,{animated:!0,value:"100"})))}}]),a}(n.Component);M.a.configure();var Oe=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={activeRecord:{}},e}return Object(i.a)(a,[{key:"componentWillMount",value:function(){console.log("activeRecord",window.activeRecord),null!=window.activeRecord?this.setState({activeRecord:window.activeRecord}):this.setState({activeRecord:{reccode:null,reccreated:"2020-10-20T11:38:42.320928+08:00",reccreatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",recdescription:null,recid:"9f46e82c-f027-49d3-b81c-f032f869c25a",recname:null,recstate:1,recupdated:"2020-10-23T00:49:34.77997+08:00",recupdatedby:"6e9d564f-a156-4845-8db6-7ac4dd757793",sysboolean_test:!1,sysdate_test:null,sysdecimal_test:null,sysenum_test:1,sysfile_test:null,sysimage_test:"",sysint_test:null,sysmoney_test:0,sysnumber_test:"\u0422\u0435\u0441\u0442\u043e\u0432\u043e\u0435 \u043e\u043a\u043d\u043e",sysstring_test:"",systime_test:null,systimedate_test:null}})}},{key:"render",value:function(){return s.a.createElement(Se,{method:{name:"test_procedure_update",displayName:"\u041e\u0431\u043d\u043e\u0432\u043b\u0435\u043d\u0438\u0435 \u0437\u0430\u043f\u0438\u0441\u0438",isEnabled:null,isAnonymous:!1,static:!1,fields:[{name:"sysstring_field",type:"SysString",typeName:"SysString",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0442\u0435\u043a\u0441\u0442\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"sysint_field",type:"SysInt",typeName:"SysInt",displayName:"\u041d\u043e\u0432\u043e\u0435 \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0447\u0438\u0441\u043b\u043e\u0432\u043e\u0433\u043e \u043f\u043e\u043b\u044f",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"checkbox_field",type:"SysBoolean",typeName:"SysBoolean",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:null,default:null,lookup:null,searchLevel:null},{name:"creatable_field",type:"SysString",typeName:"SysString",displayName:"\u0424\u043b\u0430\u0433",displaySize:null,enum:[],readOnly:"False",visible:!0,hint:null,multiple:!1,fileMask:null,isCalculated:!1,formula:null,relation:null,sequence:null,allowMultiple:null,allowDownloadZip:null,visibleSignText:null,allowSign:null,allowDelete:null,allowAdd:null,filter:null,creatable:!0,default:null,lookup:null,searchLevel:null}],showModalYesNo:null,initMethodParams:null,isPacketSigned:null,workflow:null,table:"types_table"},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},initialValues:{},activeRecord:this.state.activeRecord})}}]),a}(n.Component),Se=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(n){console.log(n),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},e.state={scunned_element:"",replaced_element:"",new_element:"",is_visible_data_grid:!1,processingAction:!1,isActionError:!1,successMessage:"",showModal:!1},e.getInitialValues=e.getInitialValues.bind(Object(h.a)(e)),e.renderPluginDataGrid=e.renderPluginDataGrid.bind(Object(h.a)(e)),e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.updateDataFromSelect=e.updateDataFromSelect.bind(Object(h.a)(e)),e.updateDataFromDataGrid=e.updateDataFromDataGrid.bind(Object(h.a)(e)),e}return Object(i.a)(a,[{key:"getInitialValues",value:function(){var e=this,t={};return this.props.method.fields.forEach((function(a){if(null!=e.props.initialValues){var n=void 0!==Ee[a.type]?Ee[a.type]:"";if(a.default){var s="var activeRecord = ".concat(JSON.stringify(e.props.initialValues),"; var result = ").concat(a.default,"(); return result;");n=new Function(s)()}t[a.name]=null!=e.props.initialValues[a.name]?e.props.initialValues[a.name]:n}else t[a.name]=Ee[a.type]})),t}},{key:"renderPluginDataGrid",value:function(e){var t=this;return this.state.is_visible_data_grid?s.a.createElement(v.a,{key:"data_grid",name:"data_grid"},(function(a){var n=a.formikfield;a.form;return s.a.createElement(ge,Object.assign({value:t.props,field:"data_grid",setFieldValue:e.setFieldValue,updateData:t.updateDataFromDataGrid,activeRecord:t.props.activeRecord},e,n))})):null}},{key:"sendRequestToOuterRdevAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:a});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"updateDataFromSelect",value:function(e){console.log("value1",e),this.setState({is_visible_data_grid:e}),console.log("updateDataFromSelect",this.state)}},{key:"updateDataFromDataGrid",value:function(e,t){console.log("value3",e),this.setState({replaced_element:e,new_element:t}),console.log("updateDataFromDataGrid",this.state)}},{key:"modalError",value:function(e){this.setState({showModal:!1}),null!=e&&(this.setState({processingAction:!1}),this.popupNotifyMessage(!1,e))}},{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n,s,l,r,o;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),console.log("handleclick1",this.refs.formik),void 0!=(t=this.refs.formik.state.values).data_grid&&null!=t.data_grid){e.next=6;break}return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u0430\u043c\u0435\u043d\u0443. \u041d\u0435 \u0432\u044b\u0431\u0440\u0430\u043d \u0437\u0430\u043c\u0435\u043d\u044f\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442"));case 6:if(console.log("newElement",this.state.new_element),a=this.state.new_element,t.data_grid.numberke,n=t.check_box_nbd,s=t.data_grid.position,l=t.data_grid.recid,a!=l){e.next=15;break}return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u0430\u043c\u0435\u043d\u0443. \u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0423\u0418\u041d \u0421\u0427 \u0443\u0436\u0435 \u0441\u0442\u043e\u0438\u0442 \u043d\u0430 \u0432\u0430\u0433\u043e\u043d\u0435"));case 15:if(null==t.select_field.batchid){e.next=18;break}return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,"\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0437\u0430\u043c\u0435\u043d\u0443. \u041f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u043d\u044b\u0439 \u0423\u0418\u041d \u0421\u0427/\u0421\u0415 \u043d\u0435 \u0434\u043e\u043b\u0436\u0435\u043d \u0441\u043e\u0441\u0442\u043e\u044f\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u0438"));case 18:return(r={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null}).body=JSON.stringify({vehicle_recid:this.props.activeRecord.recid,new_element_recid:a,is_rotation:n,position:s,old_element_recid:l}),e.next=22,this.sendRequestToOuterRdevAsync("/plugins/nbdlogicplugin/replacekeyelementorassemblyunitinvehicle",r.body);case 22:if(o=e.sent,console.log("result_replace_resp",o),!o.success){e.next=32;break}return this.setState({processingAction:!1}),this.setState({processingAction:!1,successMessage:o.message,errorMessage:o.message,isActionError:o.success}),window.closePluginModal(),this.popupNotifyMessage(!0,"".concat(o.message)),e.abrupt("return",{success:o.success,message:o.message});case 32:this.setState({processingAction:!1}),this.setState({processingAction:!1,successMessage:o.message,errorMessage:o.message,isActionError:o.success}),this.popupNotifyMessage(!1,"".concat(o.message));case 35:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"renderTest",value:function(){}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(v.c,{ref:"formik",initialValues:this.getInitialValues(),enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return s.a.createElement(v.b,{onSubmit:t.handleSubmit},s.a.createElement(v.a,{key:"select_field",name:"select_field"},(function(){return s.a.createElement(ve,{setFieldValue:t.setFieldValue,field:"select_field",updateData:e.updateDataFromSelect})})),e.renderPluginDataGrid(t),s.a.createElement("hr",null),s.a.createElement(b.a,null,s.a.createElement(_.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",s.a.createElement(_.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),s.a.createElement("hr",null))}}),s.a.createElement(ke,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}))}}]),a}(s.a.Component),Ee={SysGUID:"",SysString:"",SysMultiLineString:"",SysBoolean:!1,SysNumber:null,SysInt:null,SysMoney:0,SysDecimal:null,SysENUM:null,SysRelation:null},xe=Oe,we=(a(1341),n.Component,n.Component,n.Component,a(1342),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var s;return Object(o.a)(this,a),(s=t.call(this,e)).handleChange=function(e){null!=e&&e.length>s.state.options.length&&s.handleNewOptionClick(e[e.length-1]),console.log("handle_change"),console.log("handle_change",e),s.props.setFieldValue(s.props.field.name,JSON.stringify(e))},s.handleNewOptionClick=function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleNewOptionClick",t),a=t.value,s.setState({isLoadingDetail:!0}),(n=s.state.addedItems).push(a),!(null!=s.state.options&&s.state.options.length>0)){e.next=10;break}if(l=Object(T.a)(s.state.options),null==l.find((function(e){return e.numberValue==a}))){e.next=10;break}return e.abrupt("return",s.modalError("\u0414\u0430\u043d\u043d\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442 \u0443\u0436\u0435 \u0431\u044b\u043b \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d."));case 10:if(null==a&&""==a){e.next=15;break}return e.next=13,s.validateKeyElementForConfirmBatch(a);case 13:e.next=16;break;case 15:return e.abrupt("return",s.modalError("\u0412 \u043f\u0430\u0440\u0442\u0438\u044e \u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u043b\u044f\u0442\u044c \u0442\u043e\u043b\u044c\u043a\u043e \u0421\u0427"));case 16:s.setState({addedItems:n});case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),s.popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(n.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(n.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(s){console.log(s),M.a.error(n.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},s.prepareValue=function(){return s.props.value instanceof Array?s.props.value[0]:s.props.value},s.state={options:[],isLoading:!1,isLoadingDetail:!1,showModal:!1,addedItems:[],modalItems:[],modalValue:"",currentNumber:{},currentElement:{},currentElementType:"",showDeleteModal:!1,itemForDelete:null,isAssemblyUnit:!1,hintText:"\u0421\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u043e\u0439 \u0447\u0430\u0441\u0442\u0438 \u0432 \u043f\u0430\u0440\u0442\u0438\u0438"},s.handleNewOptionClick=s.handleNewOptionClick.bind(Object(h.a)(s)),s.handleModalChange=s.handleModalChange.bind(Object(h.a)(s)),s.renderDeleteConfirm=s.renderDeleteConfirm.bind(Object(h.a)(s)),s.handleOkModal=s.handleOkModal.bind(Object(h.a)(s)),s}return Object(i.a)(a,[{key:"validateKeyElementForConfirmBatch",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,s,l,r,o,i,c,u,d,m,h,f,b,_,y,g,v;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("24225a06-5efb-4966-9db6-1c47acb92bcf"==this.props.activeRecord.batch_status){e.next=2;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u043f\u0440\u043e\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0423\u0418\u041d, \u043f\u043e\u043a\u0430 \u043f\u0430\u0440\u0442\u0438\u044f <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u043d\u0430\u0445\u043e\u0434\u0438\u0442\u0441\u044f \u0432 \u0442\u0435\u043a\u0443\u0449\u0435\u043c \u0441\u0442\u0430\u0442\u0443\u0441\u0435.")));case 2:if(80,!(this.props.activeRecord.count_passport+this.state.options.length>=80)){e.next=5;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427 ").concat(t,": \u043f\u0440\u0435\u0432\u044b\u0448\u0435\u043d \u043b\u0438\u043c\u0438\u0442 \u0432 \u043f\u0430\u0440\u0442\u0438\u0438.")));case 5:return this.setState({currentElement:t,currentElementType:"numberkeConfirm"}),a={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"ke_numbers",options:{recname:t}}},e.next=9,this.sendAuthorizedRequestAsyncPost("/api/executejs",a);case 9:if(0!=(n=e.sent).result.result.success||null!=n.result.result.data){e.next=12;break}return e.abrupt("return",this.modalError("\u0423\u0418\u041d \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435"));case 12:return s=n.result.result.data[0],l={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_key_elements",options:{ke_number:s.recid}}},e.next=16,this.sendAuthorizedRequestAsyncPost("/api/executejs",l);case 16:return r=e.sent,o={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_ke_nodes",options:{unique_number_relation:s.recid}}},e.next=20,this.sendAuthorizedRequestAsyncPost("/api/executejs",o);case 20:if(i=e.sent,!this.isNullOrEmptyResponseAnonym(r.result.result)||!this.isNullOrEmptyResponseAnonym(i.result.result)){e.next=23;break}return e.abrupt("return",this.modalError("\u042d\u043b\u0435\u043c\u0435\u043d\u0442 \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d \u0432 \u0441\u0438\u0441\u0442\u0435\u043c\u0435."));case 23:if(c=null,this.isNullOrEmptyResponseAnonym(r.result.result)||!this.isNullOrEmptyResponseAnonym(i.result.result)){e.next=32;break}return u={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_key_elements",options:{numberke:t,batchid:this.props.activeRecord.recid}}},e.next=28,this.sendAuthorizedRequestAsyncPost("/api/executejs",u);case 28:if(c=e.sent,!this.isNullOrEmptyResponseAnonym(c.result.result)){e.next=31;break}return e.abrupt("return",this.modalError("\u0421\u0427 ".concat(t,' \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/').concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a >.")));case 31:this.setState({currentElement:r.result.result.data[0]});case 32:if(!this.isNullOrEmptyResponseAnonym(r.result.result)||this.isNullOrEmptyResponseAnonym(i.result.result)){e.next=40;break}return d={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_ke_nodes",options:{unique_number:t,batchid:this.props.activeRecord.recid}}},e.next=36,this.sendAuthorizedRequestAsyncPost("/api/executejs",d);case 36:if(c=e.sent,!this.isNullOrEmptyResponseAnonym(c.result.result)){e.next=39;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t,' \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/').concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a >.")));case 39:this.setState({currentElement:i.result.result.data[0],isAssemblyUnit:!0});case 40:if(m=c.result.result.data[0],2!=this.props.activeRecord.is_assembly_unit_or_key_element){e.next=83;break}if(null==this.props.activeRecord.product_name||""==this.props.activeRecord.product_name){e.next=81;break}if(this.isNullOrEmptyResponseAnonym(r.result.result)){e.next=57;break}return h={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_ke_nodes",options:{recid:r.result.result.data[0].ke_node,batchid:this.props.activeRecord.recid}}},e.next=47,this.sendAuthorizedRequestAsyncPost("/api/executejs",h);case 47:if(f=e.sent,b=f.result.result.data[0],!this.isNullOrEmptyResponseAnonym(f.result.result)){e.next=51;break}return e.abrupt("return",this.modalError("\u0421\u0427 ".concat(t,' \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/').concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a > \u0438\u043b\u0438 \u043d\u0435 \u0432\u0445\u043e\u0434\u0438\u0442 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0421\u0415, \u043d\u0430\u0445\u043e\u0434\u044f\u0449\u0438\u0439\u0441\u044f \u0432 \u043f\u0430\u0440\u0442\u0438\u0438.")));case 51:if(b.ke_node_type==this.props.activeRecord.product_name){e.next=53;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427/\u0421\u0415 ").concat(m.numberke,": \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 53:if(b.documentation_number==this.props.activeRecord.documentation_number){e.next=55;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427/\u0421\u0415 ").concat(t,": \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437\u0434\u0435\u043b\u0438\u044f \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 55:if(b.certificate_number==this.props.activeRecord.certificate){e.next=57;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427/\u0421\u0415 ").concat(t,": \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 57:if(this.isNullOrEmptyResponseAnonym(i.result.result)){e.next=81;break}if(null==(_=i.result.result.data[0]).parent_ke_node||""==_.parent_ke_node){e.next=75;break}return y={method:"remote_executejs",fields:{name_method:"get_entity_static",name_table:"reestr_ke_nodes",options:{recid:_.parent_ke_node,batchid:this.props.activeRecord.recid}}},e.next=63,this.sendAuthorizedRequestAsyncPost("/api/executejs",y);case 63:if(g=e.sent,v=g.result.result.data[0],!this.isNullOrEmptyResponseAnonym(g.result.result)){e.next=67;break}return e.abrupt("return",this.modalError("\u0421\u0415 ".concat(t,' \u043d\u0435 \u0432\u043a\u043b\u044e\u0447\u0435\u043d \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/').concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a > \u0438\u043b\u0438 \u043d\u0435 \u0432\u0445\u043e\u0434\u0438\u0442 \u0432 \u0441\u043e\u0441\u0442\u0430\u0432 \u0440\u043e\u0434\u0438\u0442\u0435\u043b\u044c\u0441\u043a\u043e\u0433\u043e \u0421\u0415, \u043d\u0430\u0445\u043e\u0434\u044f\u0449\u0438\u0439\u0441\u044f \u0432 \u043f\u0430\u0440\u0442\u0438\u0438.")));case 67:if(v.ke_node_type==this.props.activeRecord.product_name){e.next=69;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427/\u0421\u0415 ").concat(m.numberke,": \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 69:if(v.documentation_number==this.props.activeRecord.documentation_number){e.next=71;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427/\u0421\u0415 ").concat(t,": \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437\u0434\u0435\u043b\u0438\u044f \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 71:if(v.certificate_number==this.props.activeRecord.certificate){e.next=73;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427/\u0421\u0415 ").concat(t,": \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 73:e.next=81;break;case 75:if(_.ke_node_type==this.props.activeRecord.product_name){e.next=77;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427/\u0421\u0415 ").concat(m.numberke,": \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 77:if(_.documentation_number==this.props.activeRecord.documentation_number){e.next=79;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427/\u0421\u0415 ").concat(t,": \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437\u0434\u0435\u043b\u0438\u044f \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 79:if(_.certificate_number==this.props.activeRecord.certificate){e.next=81;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427/\u0421\u0415 ").concat(t,": \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 81:e.next=101;break;case 83:if(null==this.props.activeRecord.product_name||""==this.props.activeRecord.product_name){e.next=93;break}if(this.isNullOrEmptyResponseAnonym(r.result.result)){e.next=91;break}if(m.key_element_code==this.props.activeRecord.product_name){e.next=87;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427 ").concat(m.numberke,": \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 87:if(m.documentation_number==this.props.activeRecord.documentation_number){e.next=89;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427 ").concat(t,": \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437\u0434\u0435\u043b\u0438\u044f \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 89:if(m.certificate_number==this.props.activeRecord.certificate){e.next=91;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427 ").concat(t,": \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 91:e.next=101;break;case 93:if(!(this.state.options.length>0)){e.next=101;break}if(this.isNullOrEmptyResponseAnonym(r.result.result)){e.next=101;break}if(m.key_element_code==this.state.options[0].nodeObj.key_element_code){e.next=97;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427 ").concat(t,": \u043d\u0430\u0438\u043c\u0435\u043d\u043e\u0432\u0430\u043d\u0438\u0435 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 97:if(m.documentation_number==this.state.options[0].nodeObj.documentation_number){e.next=99;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427 ").concat(t,": \u043e\u0431\u043e\u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u0438\u0437\u0434\u0435\u043b\u0438\u044f \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 99:if(m.certificate_number==this.state.options[0].nodeObj.certificate_number){e.next=101;break}return e.abrupt("return",this.modalError('\u041d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u043e \u0434\u043e\u0431\u0430\u0432\u0438\u0442\u044c \u0432 \u043f\u0430\u0440\u0442\u0438\u044e <a href="/tables/reestr_batch/'.concat(this.props.activeRecord.recid,' "" target="_blank" class="alert-link"> \u2116 ').concat(this.props.activeRecord.batch_number,"</a> \u0421\u0427 ").concat(t,": \u0441\u0435\u0440\u0442\u0438\u0444\u0438\u043a\u0430\u0442 \u043d\u0435 \u0441\u043e\u043e\u0442\u0432\u0435\u0442\u0441\u0442\u0432\u0443\u0435\u0442 \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430\u043c \u043f\u0430\u0440\u0442\u0438\u0438.")));case 101:return this.setState({showModal:!0}),this.handleOkModal(),e.abrupt("return");case 104:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"modalError",value:function(e){this.setState({showModal:!1,isLoadingDetail:!1}),null!=e&&this.popupNotifyMessage(!1,e)}},{key:"sendRequestToOuterRdevAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"GET"});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponseAnonym",value:function(e){return null==e.data||0==e.success}},{key:"sendAuthorizedRequestAsyncPost",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify(a)});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"sendAuthorizedRequestAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token"))}});case 2:return a=e.sent,e.next=5,a.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleOkModal",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n,s,l,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleOkModal_",this),console.log("handleOkModal__",this.state),t=this.state.options,console.log("handleOkModal",t),n=!1,"numberkeConfirm"==this.state.currentElementType&&(console.log("numberkeConfirm",this.state),null!=this.state.modalValue&&""!=this.state.modalValue||(a="".concat(1==this.state.isAssemblyUnit?this.state.currentElement.unique_number:this.state.currentElement.numberke)),console.log("numberValue_state",this.state),s=1==this.state.isAssemblyUnit?this.state.currentElement.unique_number:this.state.currentElement.numberke,l=1==this.state.isAssemblyUnit?this.state.currentElement.ke_node_type_calculated:this.state.currentElement.key_element_code_calculated,console.log("numberValue",s),n=!0),console.log("test_options",this.state),t.push({value:"".concat(this.state.currentElement.recid),label:a,numberValue:s,backgroundColor:void 0,color:void 0,node:void 0,nodeObj:this.state.currentElement,isKeyElement:n,isAssemblyUnit:this.state.isAssemblyUnit,name:l}),console.log("handleOkModal3",t),this.setState({options:t,showModal:!1,isLoadingDetail:!1,modalValue:""}),console.log("handleOkModal4",t),r=t.map((function(e){return{numberValue:e.numberValue,recid:e.value,isAssemblyUnit:e.isAssemblyUnit,name:e.name}})),console.log("handleOkModal4",r),this.props.setFieldValue(this.props.field.name,JSON.stringify(r));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"handleDeleteItemClick",value:function(e){this.setState({showDeleteModal:!0,itemForDelete:e})}},{key:"deleteValue",value:function(){var e=Object(m.a)(p.a.mark((function e(t){var a,n,s,l,r;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Object(T.a)(this.state.options),-1!==(n=a.indexOf(t))&&(a.splice(n,1),this.setState({options:a}),this.props.setFieldValue(this.props.field.name,JSON.stringify(a))),this.setState({showDeleteModal:!1}),s=Object(T.a)(this.state.addedItems),l=s.find((function(e){return e==t.numberValue})),-1!==(r=s.indexOf(l))&&(s.splice(r,1),this.setState({addedItems:s}),this.props.updateUinElementsFieldState(0==s.length||null==s),this.props.updateUinState());case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"renderDeleteConfirm",value:function(){var e=this;return n.createElement($.a,{isOpen:this.state.showDeleteModal,size:"xl"},n.createElement(U.a,{toggle:function(){e.setState({showDeleteModal:!1})}},"\u0412\u043d\u0438\u043c\u0430\u043d\u0438\u0435!"),n.createElement(H.a,null,n.createElement("h5",null,"\u0412\u044b \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043b\u044c\u043d\u043e \u0445\u043e\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043b\u0438\u0442\u044c \u0441\u043a\u0430\u043d\u0438\u0440\u0443\u0435\u043c\u044b\u0439 \u044d\u043b\u0435\u043c\u0435\u043d\u0442?")),n.createElement(J.a,null,n.createElement(_.a,{size:"sm",onClick:function(){e.setState({showDeleteModal:!1})}},n.createElement("i",{className:"fa fa-ban"})," \u041e\u0442\u043c\u0435\u043d\u0430"),n.createElement(_.a,{size:"sm",color:"danger",onClick:function(){e.deleteValue(e.state.itemForDelete)}},n.createElement("i",{className:"fa fa-times"})," \u0423\u0434\u0430\u043b\u0438\u0442\u044c")))}},{key:"handleModalChange",value:function(e){this.setState({modalValue:e})}},{key:"render",value:function(){var e=this;console.log("render_creatable",this.props);return n.createElement(k.a,null,n.createElement(O.a,null,n.createElement("b",null,this.props.field.displayName)),n.createElement(z.a,{name:this.props.field.name,components:{MultiValue:function(t){var a={backgroundColor:t.data.backgroundColor,color:t.data.color};return n.createElement("div",{className:"SelectValue",style:a},n.createElement("span",{className:"SelectValueIcon","aria-hidden":"true",onClick:function(){return e.handleDeleteItemClick(t.data)}},"\xd7"),n.createElement("span",{className:"SelectValueLabel",role:"option","aria-selected":"true"},t.data.label,n.createElement("span",{className:"SelectAriaOnly"},"\xa0")))}},placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",clearValueText:"\u041e\u0447\u0438\u0441\u0442\u0438\u0442\u044c",onChange:this.handleChange,value:this.state.options,isMulti:!0,noOptionsMessage:function(){return"\u0412\u0432\u0435\u0434\u0438\u0442\u0435 \u0443\u043d\u0438\u043a\u0430\u043b\u044c\u043d\u044b\u0439 \u043d\u043e\u043c\u0435\u0440"},formatCreateLabel:function(e){return"\u0414\u043e\u0431\u0430\u0432\u0438\u0442\u044c: ".concat(e)},isClearable:!1,backspaceRemovesValue:!1,isDisabled:this.props.field.isDisabled||this.state.isLoadingDetail,isLoading:this.state.isLoadingDetail,styles:{control:function(e,t){var a=t.isFocused;return Object(R.a)(Object(R.a)({},e),{},{boxShadow:a?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:a?"#68a1be":"#e4e7ea",":hover":{borderColor:a?"#68a1be":"#e4e7ea"}})},option:function(e,t){var a=t.isDisabled,n=t.isFocused,s=t.isSelected;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:a?null:s?"#f5fafe":n?"#ecf5ff":null,color:"black"})}}}),n.createElement(E.a,{className:"text-muted"},1!=this.props.isGetBatchField?this.state.hintText:"\u0421\u0447\u0438\u0442\u0430\u0439\u0442\u0435 \u0423\u0418\u041d \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0445 \u0447\u0430\u0441\u0442\u0435\u0439, \u043a\u043e\u0442\u043e\u0440\u044b\u0435 \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b"),this.renderDeleteConfirm())}}]),a}(n.Component)),Ne=(n.Component,n.Component,function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={checkBoxValue:void 0},e.onValueChanged=e.onValueChanged.bind(Object(h.a)(e)),e}return Object(i.a)(a,[{key:"onValueChanged",value:function(e){this.setState({checkBoxValue:e.value}),this.props.setFieldValue(this.props.field.name,e.value),this.props.updateData(e.value)}},{key:"render",value:function(){return s.a.createElement("div",null,s.a.createElement(ee.CheckBox,{name:this.props.field.name,onValueChanged:this.onValueChanged,text:this.props.field.displayName,defaultValue:!1}))}}]),a}(n.Component)),Te=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),M.a.success(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(a,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return s.a.createElement($.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},s.a.createElement(H.a,null,s.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),s.a.createElement(ae.a,{animated:!0,value:"100"})))}}]),a}(n.Component),Ce=(n.Component,function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).state={value:""},n}return Object(i.a)(a,[{key:"render",value:function(){return console.log("this.props_message",this.props),console.log("this.props_message",this.refs),s.a.createElement("div",{style:{marginTop:"20px"}},s.a.createElement(Y.a,{color:"dark",isOpen:this.props.isvisibleMessage,name:this.props.field.name,style:{backgroundColor:"#e8e8e8"}},s.a.createElement("p",{style:{margin:"0 auto"}},s.a.createElement("b",null,this.props.field.text_bold),this.props.field.text)))}}]),a}(n.Component));M.a.configure();var Re=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={activeRecord:null,tableName:"",place:""},e}return Object(i.a)(a,[{key:"componentWillMount",value:function(){console.log("rdev_modalDataPack",window.rdev_modalDataPack),"edit"==window.rdev_modalDataPack.place?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords}):window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords[0]}):this.setState({activeRecord:null}),this.setState({tableName:window.rdev_modalDataPack.tableName}),this.setState({place:window.rdev_modalDataPack.place}),console.log("active=",window.rdev_modalDataPack.selectedRecords)}},{key:"render",value:function(){return s.a.createElement(je,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},place:this.state.place,tableName:this.state.tableName,initialValues:{},activeRecord:this.state.activeRecord})}}]),a}(n.Component),je=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).updateStateMessage=function(t){e.setState({is_visible_message:t})},e.popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(n){console.log(n),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},e.state={selected_template:null,count:1,is_pasported:!1,is_uin_field_empty:!0,is_uin_elements_field_empty:!0,is_uin_data_empty:!0,uin_grouping_elements:[],show_modal:!1,ref_data_grid:null,select_template_plate_field:null,select_template_insert_field:null,select_template_ring_field:null,select_application_number_field:null,processingAction:!1,isActionError:!1,successMessage:"",stateTableLoaded:!1,stateTableLoading:!1,is_visible_message:!1},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.updateStateMessage=e.updateStateMessage.bind(Object(h.a)(e)),e}return Object(i.a)(a,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n,s,l;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),console.log("handleclick",this.props),console.log("handleclick",this.refs),t=JSON.parse(this.refs.formik.state.values.uin_elements_field),console.log("ke_numbers_arr",t),t.length,1==this.refs.formik.state.values.is_get_batch_field){e.next=17;break}return a=t[0].numberValue,n={ke_number:a,recid:this.props.activeRecord.recid,is_get_batch_partially:this.refs.formik.state.values.is_get_batch_field},s={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)},console.log("requestBody",s),e.next=13,this.sendRequestToOuterRdevAsync("/plugins/nbdlogicplugin/confirmbatch",s.body);case 13:l=e.sent,console.log("result_confirmbatch_resp",l),e.next=26;break;case 17:return console.log("\u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e\u0435 \u043f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435"),n={ke_number:JSON.stringify(t),recid:this.props.activeRecord.recid,is_get_batch_partially:this.refs.formik.state.values.is_get_batch_field},console.log("parameters",n),s={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify(n)},console.log("requestBody",s),e.next=24,this.sendRequestToOuterRdevAsync("/plugins/nbdlogicplugin/confirmbatchpartially",s.body);case 24:l=e.sent,console.log("result_confirmbatch_resp",l);case 26:if(!l.success){e.next=32;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",this.popupNotifyMessage(!0,"".concat(l.message)));case 32:return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,"".concat(l.message)));case 34:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"sendRequestToOuterRdevAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:a});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(v.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return s.a.createElement(v.b,{onSubmit:t.handleSubmit},s.a.createElement("h5",{class:"modal-title"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0434\u0438\u0442\u044c \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u0438\u0435"),s.a.createElement("hr",null),s.a.createElement(b.a,null,s.a.createElement(_.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0",s.a.createElement(_.a,{size:"sp",onClick:function(){return window.closePluginModal()},style:{width:"103.63px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-ban"})," \u0417\u0430\u043a\u0440\u044b\u0442\u044c")),s.a.createElement("hr",null),s.a.createElement(v.a,{key:"uin_elements_field",name:"uin_elements_field"},(function(){return s.a.createElement(we,{setFieldValue:t.setFieldValue,activeRecord:e.props.activeRecord,tableName:e.props.tableName,isGetBatchField:e.state.is_visible_message,field:{name:"uin_elements_field",displayName:"\u0423\u0418\u041d \u0434\u043b\u044f \u0438\u0434\u0435\u043d\u0442\u0438\u0444\u0438\u043a\u0430\u0446\u0438\u0438"}})})),s.a.createElement(v.a,{key:"is_get_batch_field",name:"is_get_batch_field"},(function(){return s.a.createElement(Ne,{setFieldValue:t.setFieldValue,activeRecord:e.props.activeRecord,tableName:e.props.tableName,updateData:e.updateStateMessage,field:{name:"is_get_batch_field",displayName:"\u041f\u043e\u043b\u0443\u0447\u0438\u0442\u044c \u043f\u0430\u0440\u0442\u0438\u044e \u0447\u0430\u0441\u0442\u0438\u0447\u043d\u043e"}})})),s.a.createElement(v.a,{key:"message_field",name:"message_field"},(function(){return s.a.createElement(Ce,{setFieldValue:t.setFieldValue,activeRecord:e.props.activeRecord,tableName:e.props.tableName,isvisibleMessage:e.state.is_visible_message,field:{name:"message_field",text_bold:"\u0412 \u0440\u0430\u043c\u043a\u0430\u0445 \u0434\u0430\u043d\u043d\u043e\u0439 \u043f\u0430\u0440\u0442\u0438\u0438 \u043d\u0435 \u0431\u0443\u0434\u0443\u0442 \u043f\u0440\u0438\u043d\u044f\u0442\u044b \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0435 \u0447\u0430\u0441\u0442\u0438, \u0423\u0418\u041d \u043a\u043e\u0442\u043e\u0440\u044b\u0445 \u0431\u044b\u043b\u0438 \u043e\u0442\u0441\u043a\u0430\u043d\u0438\u0440\u043e\u0432\u0430\u043d\u044b. ",text:"\u0412\u0441\u0435 \u043f\u0440\u043e\u0447\u0438\u0435 \u0441\u043e\u0441\u0442\u0430\u0432\u043d\u044b\u0435 \u0447\u0430\u0441\u0442\u0438 \u0431\u0443\u0434\u0443\u0442 \u043f\u0440\u0438\u043d\u044f\u0442\u044b \u0438 \u043f\u043e \u043d\u0438\u043c \u0431\u0443\u0434\u0443\u0442 \u043f\u043e\u043b\u0443\u0447\u0435\u043d\u044b \u044d\u043b\u0435\u043a\u0442\u0440\u043e\u043d\u043d\u044b\u0435 \u043f\u0430\u0441\u043f\u043e\u0440\u0442\u0430."}})})))}}),s.a.createElement(Te,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}),console.log("render_app",this))}}]),a}(s.a.Component),De=(a(1343),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=function(e){console.log("handleChange",e),n.setState({selectedValue:e}),n.props.setFieldValue(n.props.field,n.state.selectedValue),n.props.updateData(e,n.props.field.name)},n.state={options:[],uin:null,currentElement:{},currentElementType:"",text_select:"",selectedValue:null,fieldForShow:"recname"},n.getDictionaries=n.getDictionaries.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"componentDidMount",value:function(){var e=Object(m.a)(p.a.mark((function e(){return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("state=",this.state),console.log("props=",this.props),console.log("componentDidMount"),this.getDictionaries(),this.props.field.isUinField&&(this.setState({uin:null!=this.props.field.uin?this.props.field:null}),null!=this.props.field.uin&&this.props.updateUinState(!1));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDictionaries",value:function(){var e=this,t="",a="",n="",s="";switch(this.props.field.name){case"disposal_reason_field":if(t="dictionary_disposal_reasons",this.setState({fieldForShow:"recname"}),a="recname,name_key_element,name_ke_node",console.log("this.props.field.filter",this.props.field.filter),console.log("this.props.tableName",this.props.tableName),""==(n=null!=this.props.field.filter&&""!=this.props.field.filter?"reestr_key_elements"==this.props.tableName?"name_key_element eq ".concat(this.props.field.filter," and "):"name_ke_node eq ".concat(this.props.field.filter," and "):""))return this.setState({options:null}),void this.setState({selectedValue:null});break;case"uin_relation_field":a="reestr_key_elements"==(t=this.props.tableName)?"key_element_code,numberke":"unique_number,ke_node_type",n="recid eq ".concat(this.props.activeRecord.recid," and "),s="reestr_key_elements"==t?"key_element_codeitem($select=recname)":"ke_node_typeitem($select=recname)"}console.log("/odata/".concat(t,"?$select=").concat(a,",recid&$orderBy=").concat(a,"&$filter=").concat(n,"recstate eq 1&$expand=").concat(s)),fetch("/odata/".concat(t,"?$select=").concat(a,",recid&$orderBy=").concat(a,"&$filter=").concat(n,"recstate eq 1&$expand=").concat(s),{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"}}).then((function(e){return e.json()})).then((function(a){if(e.isNullOrEmptyResponse(a))return console.log("\u0414\u0430\u043d\u043d\u044b\u0435 \u0441\u043f\u0440\u0430\u0432\u043e\u0447\u043d\u0438\u043a\u0430 ".concat(t," \u043d\u0435 \u043d\u0430\u0439\u0434\u0435\u043d\u044b"));if("repair_operation_field"==e.props.field.name&&a.value.forEach((function(e){return e.recname=e.work_performed_type_operationitem.repair_operation})),"uin_relation_field"==e.props.field.name){console.log("uin response",a.value);var n={recid:a.value[0],recname:"reestr_key_elements"==t?"".concat(a.value[0].numberke,", ").concat(a.value[0].key_element_codeitem.recname):"".concat(a.value[0].unique_number,", ").concat(a.value[0].ke_node_typeitem.recname)};e.setState({selectedValue:n}),e.props.updateData(a.value[0],e.props.field.name)}else e.setState({options:a.value}),console.log("loadRepairTypes data.value ",a.value)})).catch((function(e){console.log("Request failed: ",e)}))}},{key:"isNullOrEmptyResponse",value:function(e){return null==e||null==e.value||0==e.value.length}},{key:"render",value:function(){var e=this;return s.a.createElement(k.a,{row:!0},s.a.createElement(O.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(g.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},s.a.createElement(C.a,{id:this.props.field,name:this.props.field,getOptionLabel:function(t){return t[e.state.fieldForShow]},getOptionValue:function(e){return e.recid},options:this.state.options,onChange:this.handleChange,placeholder:"\u0412\u044b\u0431\u0440\u0430\u0442\u044c..",className:"basic-single",classNamePrefix:"select",value:this.state.selectedValue,isClearable:!0,isSearchable:!0,isDisabled:this.props.field.isUinField||this.props.field.isDisabled,styles:{control:function(e,t){var a=t.isFocused;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:"white",boxShadow:a?"0 0 0 0.2rem rgb(50 94 116 / 25%)":null,borderColor:a?"#68a1be":"#e4e7ea",":hover":{borderColor:a?"#68a1be":"#e4e7ea"}})},option:function(e,t){var a=t.isDisabled,n=t.isFocused,s=t.isSelected;return Object(R.a)(Object(R.a)({},e),{},{backgroundColor:a?null:s?"#f5fafe":n?"#ecf5ff":null,color:"black"})}}})))}}]),a}(n.Component)),Ae=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).notifySuccess=function(e){console.log("notify",e),M.a.success(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:11,closed:!1})})}catch(t){console.log(t)}},e.notifyError=function(e){console.log("notify",e),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:e}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3});try{fetch("/odata/rdev___events_log",{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({message:e,eventtype:12,closed:!1})})}catch(t){console.log(t)}},e.state={waiting:!1},e}return Object(i.a)(a,[{key:"componentWillReceiveProps",value:function(e){!e.waiting&&this.props.waiting?(this.setState({waiting:!1}),e.error&&this.props.isShowError&&e.isShowError||this.props.isShowSuccess&&e.isShowSuccess):e.waiting&&!this.props.waiting&&this.setState({waiting:!0})}},{key:"render",value:function(){return s.a.createElement($.a,{backdrop:"static",isOpen:this.state.waiting,size:"lg"},s.a.createElement(H.a,null,s.a.createElement("h3",null,"\u041f\u043e\u0436\u0430\u043b\u0443\u0439\u0441\u0442\u0430, \u043f\u043e\u0434\u043e\u0436\u0434\u0438\u0442\u0435..."),s.a.createElement(ae.a,{animated:!0,value:"100"})))}}]),a}(n.Component),Me=(a(1344),function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){var n;return Object(o.a)(this,a),(n=t.call(this,e)).handleChange=function(e){if(console.log("date change"),null!=e.value){he()().utcOffset();var t=he()(e.value),a=new Date(Date.UTC(t.year(),t.month(),t.date()));n.setState({selectedValue:a}),n.props.setFieldValue(n.props.field.name,a)}else n.setState({selectedValue:null}),n.props.setFieldValue(n.props.field.name,e.value);n.props.setFieldTouched(n.props.field.name,!0),n.props.updateData(e.value,n.props.field.name)},n.getType=function(){return"SysTimeDate"===n.props.field.type?"datetime":"SysDate"===n.props.field.type?"date":"datetime"},n.state={selectedValue:new Date},n.handleChange=n.handleChange.bind(Object(h.a)(n)),n}return Object(i.a)(a,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",elementAttr:{class:"rdev-read-only-control"}},s.a.createElement(k.a,{key:"input_".concat(this.props.field.name),row:!0},s.a.createElement(O.a,{sm:4,style:{flex:"0 0 30%",maxWidth:"30%"}},s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(g.a,{sm:8,style:{flex:"0 0 70%",maxWidth:"70%"}},s.a.createElement(pe.DateBox,{className:"repairFormDateBox",width:"100%",type:"date",id:this.props.field,name:this.props.field.name,defaultValue:new Date,showClearButton:!0,useMaskBehavior:!0,displayFormat:"dd.MM.yyyy",onValueChanged:this.handleChange,value:this.state.selectedValue})))}}]),a}(n.Component)),Ie=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){return Object(o.a)(this,a),t.apply(this,arguments)}return Object(i.a)(a,[{key:"render",value:function(){return this.props.readOnly&&{readOnly:!0,placeholder:"-",className:"rdev-read-only-control"},s.a.createElement(k.a,{row:!0},s.a.createElement(O.a,{sm:2,style:{flex:"0 0 30%",maxWidth:"30%"}},s.a.createElement("b",null,this.props.field.displayName)),s.a.createElement(g.a,{sm:10,style:{flex:"0 0 70%",maxWidth:"70%"}},s.a.createElement(S.a,{name:this.props.field.name,onBlur:this.props.onBlur,disabled:this.props.field.isDisabled,defaultValue:null!=this.props.activeRecord.numberke?this.props.activeRecord.numberke:this.props.activeRecord.unique_number})))}}]),a}(n.Component);M.a.configure();var Ve=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).state={activeRecord:null,tableName:"",place:"",isNeedDataGrid:!1},e}return Object(i.a)(a,[{key:"componentWillMount",value:function(){console.log("rdev_modalDataPack",window.rdev_modalDataPack),"edit"==window.rdev_modalDataPack.place?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords}):window.rdev_modalDataPack.countOfSelectedRecords>0&&"contextMenu"==window.rdev_modalDataPack.placeEvent?this.setState({activeRecord:window.rdev_modalDataPack.selectedRecords[0]}):this.setState({activeRecord:null,isNeedDataGrid:!0}),this.setState({tableName:window.rdev_modalDataPack.tableName,place:window.rdev_modalDataPack.place}),console.log("active=",window.rdev_modalDataPack.selectedRecords)}},{key:"render",value:function(){return s.a.createElement(qe,{method:{},onSubmit:function(){return console.log("Plugin.onSubmit")},onCancel:function(){return console.log("Plugin.onCancel")},place:this.state.place,tableName:this.state.tableName,initialValues:{},activeRecord:this.state.activeRecord})}}]),a}(n.Component),qe=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(){var e;return Object(o.a)(this,a),(e=t.call(this)).updateSelectedValues=function(t,a){switch(a){case"uin_relation_field":e.setState({selectedRecord:e.props.activeRecord,selectedElementType:"reestr_key_elements"==e.props.tableName?t.key_element_code:t.ke_node_type});break;case"disposal_reason_field":e.setState({selectedDisposalReason:t})}},e.updateSelectedDate=function(t){e.setState({selectedDisposalDate:t})},e.popupNotifyMessage=function(e,t){var a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:null};!0===e?(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-success",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:11,closed:!1})):(M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:t}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3}),a.body=JSON.stringify({message:t,eventtype:12,closed:!1})),console.log("eventsLogRequestBody",a);try{fetch("/odata/rdev___events_log",a)}catch(n){console.log(n),M.a.error(s.a.createElement("span",{dangerouslySetInnerHTML:{__html:"\u041d\u0435 \u0443\u0434\u0430\u043b\u043e\u0441\u044c \u0441\u043e\u0445\u0440\u0430\u043d\u0438\u0442\u044c \u0434\u0430\u043d\u043d\u044b\u0435 \u0432 \u0442\u0430\u0431\u043b\u0438\u0446\u0443 rdev___events_log, \u0441\u043c\u043e\u0442\u0440\u0435\u0442\u044c \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0435 \u0432 \u043a\u043e\u043d\u0441\u043e\u043b\u0438"}}),{className:"bg-danger",position:M.a.POSITION.BOTTOM_RIGHT,autoClose:5e3})}},e.state={selectedDisposalReason:null,selectedFaultType:null,selectedRepairOperation:null,selectedDisposalDate:new Date,selectedRecord:null,selectedRow:null,selectedTable:"",selectedElementType:"",isVisibleDataGrid:!1,inputRecord:null,uin:null,is_type_repair_empty:!0,is_uin_creatable_lookup_empty:!0,is_uin_empty:!0,processingAction:!1,ref_data_grid:null},e.handleclick=e.handleclick.bind(Object(h.a)(e)),e.dataGrid={},e.updateSelectedValues=e.updateSelectedValues.bind(Object(h.a)(e)),e.updateSelectedDate=e.updateSelectedDate.bind(Object(h.a)(e)),e}return Object(i.a)(a,[{key:"handleclick",value:function(){var e=Object(m.a)(p.a.mark((function e(){var t,a,n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.setState({processingAction:!0}),t="","undefined"!==this.state.selectedDisposalDate&&null!=this.state.selectedDisposalDate||(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u0414\u0430\u0442\u0430 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438". ')),this.isNullObject(this.state.selectedDisposalReason)&&(t=String().concat(t,'\u041d\u0435 \u0443\u043a\u0430\u0437\u0430\u043d\u043e \u0437\u043d\u0430\u0447\u0435\u043d\u0438\u0435 \u043e\u0431\u044f\u0437\u0430\u0442\u0435\u043b\u044c\u043d\u043e\u0433\u043e \u043f\u0430\u0440\u0430\u043c\u0435\u0442\u0440\u0430 "\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438". ')),!this.isNotEmptyString(t)){e.next=9;break}return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,t));case 9:return a={headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:JSON.stringify({recid:this.props.activeRecord.recid,table_name:this.props.tableName,disposal_date:this.state.selectedDisposalDate,disposal_reason:this.state.selectedDisposalReason.recname})},console.log("requestBody",a),e.next=13,this.sendRequestToOuterRdevAsync("/plugins/nbdlogicplugin/registerdisposal",a.body);case 13:if(n=e.sent,console.log("registerdisposal_resp",n),!n.success){e.next=21;break}return this.setState({processingAction:!1}),window.closePluginModal(),e.abrupt("return",this.popupNotifyMessage(!0,"".concat(n.message)));case 21:return this.setState({processingAction:!1}),e.abrupt("return",this.popupNotifyMessage(!1,"".concat(n.message)));case 23:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(v.c,{ref:"formik",enableReinitialize:!0,onSubmit:function(){return e.props.onSubmit()},render:function(t){return s.a.createElement(v.b,{onSubmit:t.handleSubmit},s.a.createElement("h5",{class:"modal-title"},"\u0417\u0430\u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044e"),s.a.createElement("hr",null),s.a.createElement(v.a,{key:"uin_relation_field",name:"uin_relation_field"},(function(){return s.a.createElement(Ie,{setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,field:{name:"uin_relation_field",displayName:"\u0423\u0418\u041d",isDisabled:!0},activeRecord:e.props.activeRecord,tableName:e.props.tableName})})),s.a.createElement(v.a,{key:"date_field",name:"date_field"},(function(){return s.a.createElement(Me,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedDate,field:{name:"date_field",displayName:"\u0414\u0430\u0442\u0430 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438",isUinElementsField:!0}},t))})),s.a.createElement(v.a,{key:"disposal_reason_field",name:"disposal_reason_field"},(function(){return s.a.createElement(De,Object.assign({setFieldValue:t.setFieldValue,updateData:e.updateSelectedValues,tableName:e.props.tableName,field:{name:"disposal_reason_field",displayName:"\u041f\u0440\u0438\u0447\u0438\u043d\u0430 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u0438",filter:null!=e.props.activeRecord&&null!=e.props.activeRecord?"reestr_key_elements"==e.props.tableName?void 0==e.props.activeRecord.key_element_code._value?e.props.activeRecord.key_element_code:e.props.activeRecord.key_element_code._value:void 0==e.props.activeRecord.ke_node_type._value?e.props.activeRecord.ke_node_type:e.props.activeRecord.ke_node_type._value:""}},t))})),s.a.createElement("div",{style:{marginTop:"30px"}},s.a.createElement(Y.a,{color:"secondary",isOpen:null!=e.state.selectedDisposalReason},s.a.createElement("h4",{className:"alert-heading"},"\u041f\u043e\u0434\u0442\u0432\u0435\u0440\u0436\u0434\u0435\u043d\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0439"),"reestr_key_elements"==e.props.tableName&&s.a.createElement(s.a.Fragment,null,"\u0412\u044b \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442\u0435 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044e \u0434\u043b\u044f \u0421\u0427 ",null!=e.props.activeRecord&&null!=e.props.activeRecord?void 0==e.props.activeRecord.key_element_codeitem?e.props.activeRecord.key_element_code_calculated:e.props.activeRecord.key_element_codeitem.recname:""," \u0441 \u0423\u0418\u041d ",null!=e.props.activeRecord&&null!=e.props.activeRecord&&void 0==e.props.activeRecord.numberke._value?e.props.activeRecord.numberke:""," \u043f\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0435 ",null!=e.state.selectedDisposalReason?e.state.selectedDisposalReason.recname:"",". \u0414\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0438\u0435 \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u044f \u0441 \u0434\u0435\u0442\u0430\u043b\u044c\u044e \u0431\u0443\u0434\u0443\u0442 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b. \u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"),"reestr_ke_nodes"==e.props.tableName&&s.a.createElement(s.a.Fragment,null,"\u0412\u044b \u0440\u0435\u0433\u0438\u0441\u0442\u0440\u0438\u0440\u0443\u0435\u0442\u0435 \u0443\u0442\u0438\u043b\u0438\u0437\u0430\u0446\u0438\u044e \u0434\u043b\u044f \u0421\u0415 ",null!=e.props.activeRecord&&null!=e.props.activeRecord?void 0==e.props.activeRecord.ke_assembly_unit_typeitem?e.props.activeRecord.ke_assembly_unit_type_calculated:e.props.activeRecord.ke_assembly_unit_typeitem.recname:""," \u0441 \u0423\u0418\u041d ",null!=e.props.activeRecord&&null!=e.props.activeRecord&&void 0==e.props.activeRecord.unique_number._value?e.props.activeRecord.unique_number:""," \u043f\u043e \u043f\u0440\u0438\u0447\u0438\u043d\u0435 ",null!=e.state.selectedDisposalReason?e.state.selectedDisposalReason.recname:"",". \u041e\u0431\u0440\u0430\u0442\u0438\u0442\u0435 \u0432\u043d\u0438\u043c\u0430\u043d\u0438\u0435, \u0447\u0442\u043e \u0432\u0441\u0435 \u0441\u0432\u044f\u0437\u0430\u043d\u043d\u044b\u0435 \u0441 \u044d\u0442\u043e\u0439 \u0421\u0415 \u0434\u0435\u0442\u0430\u043b\u0438, \u0431\u0443\u0434\u0443\u0442 \u0442\u0430\u043a\u0436\u0435 \u0443\u0442\u0438\u043b\u0438\u0437\u0438\u0440\u043e\u0432\u0430\u043d\u044b. \u0414\u0430\u043b\u044c\u043d\u0435\u0439\u0448\u0438\u0435 \u043e\u043f\u0435\u0440\u0430\u0446\u0438\u0438 \u0441 \u043d\u0438\u043c\u0438 \u0431\u0443\u0434\u0443\u0442 \u043d\u0435\u0432\u043e\u0437\u043c\u043e\u0436\u043d\u044b. \u0412\u044b \u0443\u0432\u0435\u0440\u0435\u043d\u044b?"))),s.a.createElement("hr",null),s.a.createElement(b.a,null,s.a.createElement(_.a,{className:"btnPerform",size:"sp",onClick:e.handleclick,color:"primary",style:{width:"124px",height:"32px",padding:0}},s.a.createElement("i",{className:"fa fa-check"})," \u0412\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c"),"\xa0"))}}),s.a.createElement(Ae,{waiting:this.state.processingAction,error:this.state.isActionError,isShowSuccess:!0,isShowError:!0,successMessage:this.state.successMessage,errorMessage:this.state.successMessage}))}},{key:"sendRequestToOuterRdevAsync",value:function(){var e=Object(m.a)(p.a.mark((function e(t,a){var n;return p.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{headers:{Authorization:"Bearer ".concat(localStorage.getItem("token")),"Content-Type":"application/json"},method:"POST",body:a});case 2:return n=e.sent,e.next=5,n.json();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}()},{key:"isEmptyString",value:function(e){return null==e||"undefined"===e||""===e||0===e.length}},{key:"isNotEmptyString",value:function(e){return null!=e&&"undefined"!==e&&""!==e&&0!==e.length}},{key:"isNullObject",value:function(e){return null==e||"undefined"===e||!e||0===Object.keys(e).length}},{key:"isNotNullObject",value:function(e){return null!=e&&"undefined"!==e&&e&&0!==Object.keys(e).length}},{key:"isEmptyOrNullArray",value:function(e){return!e||null==e||"undefined"===e||e.length<=0}},{key:"isNotEmptyOrNullArray",value:function(e){return e&&null!=e&&"undefined"!==e&&e.length>0}}]),a}(s.a.Component),Fe=function(e){Object(c.a)(a,e);var t=Object(u.a)(a);function a(e){return Object(o.a)(this,a),t.call(this,e)}return Object(i.a)(a,[{key:"render",value:function(){return s.a.createElement(s.a.Fragment,null,"masscreatekeyelement"==this.props.pluginName&&s.a.createElement(I,null),"createassemblyunitornodeelement"==this.props.pluginName&&s.a.createElement(re,null),"repairregistration"==this.props.pluginName&&s.a.createElement(be,null),"replacekeyelement"==this.props.pluginName&&s.a.createElement(xe,null),"confirmacceptancebatch"==this.props.pluginName&&s.a.createElement(Re,null),"disposalregistration"==this.props.pluginName&&s.a.createElement(Ve,null))}}]),a}(n.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Pe=a(377),Be=a(613);Object(Pe.loadMessages)(Be),Object(Pe.locale)("ru"),r.a.render(s.a.createElement(s.a.Fragment,null,s.a.createElement(Fe,{pluginName:window.rdev_pluginName})),document.getElementById("custom-plugin-body")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},208:function(e,t,a){},528:function(e,t,a){},614:function(e,t,a){e.exports=a(1345)},620:function(e,t,a){},658:function(e,t,a){},659:function(e,t,a){},948:function(e,t,a){}},[[614,1,2]]]);